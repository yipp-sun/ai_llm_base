## LangChain æ¨¡å—å’Œä½“ç³»
**<font style="color:rgb(28, 30, 33);">LangChain</font>**<font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">æ˜¯ä¸€ä¸ªç”¨äºå¼€å‘ç”±å¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMsï¼‰é©±åŠ¨çš„åº”ç”¨ç¨‹åºçš„æ¡†æ¶ã€‚</font>

<font style="color:rgb(28, 30, 33);">å®˜æ–¹æ–‡æ¡£ï¼š</font>[https://python.langchain.com/docs/introduction/](https://python.langchain.com/docs/introduction/)

<font style="color:rgb(28, 30, 33);">LangChain ç®€åŒ–äº†LLMåº”ç”¨ç¨‹åºç”Ÿå‘½å‘¨æœŸçš„æ¯ä¸ªé˜¶æ®µï¼š</font>

+ **<font style="color:rgb(28, 30, 33);">å¼€å‘</font>**<font style="color:rgb(28, 30, 33);">ï¼šä½¿ç”¨LangChainçš„å¼€æºæ„å»ºæ¨¡å—å’Œç»„ä»¶æ„å»ºæ‚¨çš„åº”ç”¨ç¨‹åºã€‚åˆ©ç”¨ç¬¬ä¸‰æ–¹é›†æˆå’Œæ¨¡æ¿å¿«é€Ÿå¯åŠ¨ã€‚</font>
+ **<font style="color:rgb(28, 30, 33);">ç”Ÿäº§éƒ¨ç½²</font>**<font style="color:rgb(28, 30, 33);">ï¼šä½¿ç”¨</font>[<font style="color:rgb(28, 30, 33);">LangSmith</font>](https://docs.smith.langchain.com/)<font style="color:rgb(28, 30, 33);">æ£€æŸ¥ã€ç›‘æ§å’Œè¯„ä¼°æ‚¨çš„é“¾ï¼Œä»¥ä¾¿æ‚¨å¯ä»¥æŒç»­ä¼˜åŒ–å¹¶è‡ªä¿¡åœ°éƒ¨ç½²ã€‚</font>
+ **<font style="color:rgb(28, 30, 33);">éƒ¨ç½²</font>**<font style="color:rgb(28, 30, 33);">ï¼šä½¿ç”¨</font>[<font style="color:rgb(28, 30, 33);">LangServe</font>](http://www.aidoczh.com/langchain/v0.2/docs/langserve/)<font style="color:rgb(28, 30, 33);">å°†ä»»ä½•é“¾è½¬æ¢ä¸ºAPIã€‚</font>

![](https://cdn.nlark.com/yuque/0/2024/svg/2424104/1722307914551-22224519-abb1-4c70-9a19-dca2f95c805d.svg)

<font style="color:rgb(28, 30, 33);">å…·ä½“è€Œè¨€ï¼Œè¯¥æ¡†æ¶åŒ…æ‹¬ä»¥ä¸‹å¼€æºåº“ï¼š</font>

+ `**<font style="color:rgb(28, 30, 33);">langchain-core</font>**`<font style="color:rgb(28, 30, 33);">ï¼šåŸºæœ¬æŠ½è±¡å’ŒLangChainè¡¨è¾¾è¯­è¨€ã€‚</font>
+ `**<font style="color:rgb(28, 30, 33);">langchain-community</font>**`<font style="color:rgb(28, 30, 33);">ï¼šç¬¬ä¸‰æ–¹é›†æˆã€‚</font>
    - <font style="color:rgb(28, 30, 33);">åˆä½œä¼™ä¼´åŒ…ï¼ˆä¾‹å¦‚</font><font style="color:rgb(28, 30, 33);"> </font>`**<font style="color:rgb(28, 30, 33);">langchain-openai</font>**`<font style="color:rgb(28, 30, 33);">ï¼Œ</font>`**<font style="color:rgb(28, 30, 33);">langchain-anthropic</font>**`<font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">ç­‰ï¼‰ï¼šä¸€äº›é›†æˆå·²è¿›ä¸€æ­¥æ‹†åˆ†ä¸ºä»…ä¾èµ–äº</font><font style="color:rgb(28, 30, 33);"> </font>`**<font style="color:rgb(28, 30, 33);">langchain-core</font>**`<font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">çš„è½»é‡çº§åŒ…ã€‚</font>
+ `**<font style="color:rgb(28, 30, 33);">langchain</font>**`<font style="color:rgb(28, 30, 33);">ï¼šæ„æˆåº”ç”¨ç¨‹åºè®¤çŸ¥æ¶æ„çš„é“¾ã€ä»£ç†å’Œæ£€ç´¢ç­–ç•¥ã€‚</font>
+ [**<font style="color:rgb(28, 30, 33);">langgraph</font>**](https://langchain-ai.github.io/langgraph)<font style="color:rgb(28, 30, 33);">ï¼šé€šè¿‡å°†æ­¥éª¤å»ºæ¨¡ä¸ºå›¾ä¸­çš„è¾¹ç¼˜å’ŒèŠ‚ç‚¹ï¼Œä½¿ç”¨LLMsæ„å»ºç¨³å¥ä¸”æœ‰çŠ¶æ€çš„å¤šå‚ä¸è€…åº”ç”¨ç¨‹åºã€‚</font>
+ [**<font style="color:rgb(28, 30, 33);">langserve</font>**](http://www.aidoczh.com/langchain/v0.2/docs/langserve/)<font style="color:rgb(28, 30, 33);">ï¼šå°†LangChainé“¾éƒ¨ç½²ä¸ºREST APIã€‚</font>
+ [**<font style="color:rgb(28, 30, 33);">LangSmith</font>**](https://docs.smith.langchain.com/)<font style="color:rgb(28, 30, 33);">ï¼šä¸€ä¸ªå¼€å‘å¹³å°ï¼Œå¯è®©æ‚¨è°ƒè¯•ã€æµ‹è¯•ã€è¯„ä¼°å’Œç›‘æ§LLMåº”ç”¨ç¨‹åºã€‚</font>



## LLM & Chat models PromptTemplates, OutputParses Chains
### <font style="color:rgb(28, 30, 33);">LLMs</font>
<font style="color:rgb(28, 30, 33);">å°†å­—ç¬¦ä¸²ä½œä¸ºè¾“å…¥å¹¶è¿”å›å­—ç¬¦ä¸²çš„è¯­è¨€æ¨¡å‹ã€‚ è¿™äº›é€šå¸¸æ˜¯è¾ƒæ—§çš„æ¨¡å‹ï¼ˆè¾ƒæ–°çš„æ¨¡å‹é€šå¸¸æ˜¯</font><font style="color:rgb(28, 30, 33);"> </font>`<font style="color:rgb(28, 30, 33);">ChatModels</font>`<font style="color:rgb(28, 30, 33);">ï¼Œè§ä¸Šæ–‡ï¼‰ã€‚ å°½ç®¡åº•å±‚æ¨¡å‹æ˜¯å­—ç¬¦ä¸²è¾“å…¥ã€å­—ç¬¦ä¸²è¾“å‡ºï¼ŒLangChain å°è£…å™¨è¿˜å…è®¸è¿™äº›æ¨¡å‹æ¥å—æ¶ˆæ¯ä½œä¸ºè¾“å…¥ã€‚ è¿™ä½¿å®ƒä»¬å¯ä»¥ä¸ ChatModels äº’æ¢ä½¿ç”¨ã€‚ å½“æ¶ˆæ¯ä½œä¸ºè¾“å…¥ä¼ å…¥æ—¶ï¼Œå®ƒä»¬å°†åœ¨ä¼ é€’ç»™åº•å±‚æ¨¡å‹ä¹‹å‰åœ¨å†…éƒ¨æ ¼å¼åŒ–ä¸ºå­—ç¬¦ä¸²ã€‚ LangChain ä¸æä¾›ä»»ä½• LLMsï¼Œè€Œæ˜¯ä¾èµ–äºç¬¬ä¸‰æ–¹é›†æˆã€‚</font>

### <font style="color:rgb(28, 30, 33);">Messages(æ¶ˆæ¯)</font>
<font style="color:rgb(28, 30, 33);">ä¸€äº›è¯­è¨€æ¨¡å‹å°†æ¶ˆæ¯åˆ—è¡¨ä½œä¸ºè¾“å…¥å¹¶è¿”å›æ¶ˆæ¯ã€‚ æœ‰å‡ ç§ä¸åŒç±»å‹çš„æ¶ˆæ¯ã€‚ æ‰€æœ‰æ¶ˆæ¯éƒ½æœ‰</font><font style="color:rgb(28, 30, 33);"> </font>`<font style="color:rgb(28, 30, 33);">role</font>`<font style="color:rgb(28, 30, 33);">ã€</font>`<font style="color:rgb(28, 30, 33);">content</font>`<font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">å’Œ</font><font style="color:rgb(28, 30, 33);"> </font>`<font style="color:rgb(28, 30, 33);">response_metadata</font>`<font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">å±æ€§ã€‚</font><font style="color:rgb(28, 30, 33);"> </font>`<font style="color:rgb(28, 30, 33);">role</font>`<font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">æè¿°äº†æ¶ˆæ¯çš„å‘å‡ºè€…æ˜¯è°ã€‚ LangChain ä¸ºä¸åŒçš„è§’è‰²è®¾è®¡äº†ä¸åŒçš„æ¶ˆæ¯ç±»ã€‚</font><font style="color:rgb(28, 30, 33);"> </font>`<font style="color:rgb(28, 30, 33);">content</font>`<font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">å±æ€§æè¿°äº†æ¶ˆæ¯çš„å†…å®¹ã€‚ è¿™å¯ä»¥æ˜¯å‡ ç§ä¸åŒçš„å†…å®¹ï¼š</font>

+ <font style="color:rgb(28, 30, 33);">ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ˆå¤§å¤šæ•°æ¨¡å‹å¤„ç†è¿™ç§ç±»å‹çš„å†…å®¹ï¼‰</font>
+ <font style="color:rgb(28, 30, 33);">ä¸€ä¸ªå­—å…¸åˆ—è¡¨ï¼ˆç”¨äºå¤šæ¨¡æ€è¾“å…¥ï¼Œå…¶ä¸­å­—å…¸åŒ…å«æœ‰å…³è¯¥è¾“å…¥ç±»å‹å’Œè¯¥è¾“å…¥ä½ç½®çš„ä¿¡æ¯ï¼‰</font>

#### <font style="color:rgb(28, 30, 33);">HumanMessage</font>
<font style="color:rgb(28, 30, 33);">è¿™ä»£è¡¨ç”¨æˆ·å‘é€çš„æ¶ˆæ¯ã€‚</font>

#### <font style="color:rgb(28, 30, 33);">AIMessage</font>
<font style="color:rgb(28, 30, 33);">è¿™ä»£è¡¨æ¨¡å‹å‘é€çš„æ¶ˆæ¯ã€‚é™¤äº†</font><font style="color:rgb(28, 30, 33);"> </font>`<font style="color:rgb(28, 30, 33);">content</font>`<font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">å±æ€§å¤–ï¼Œè¿™äº›æ¶ˆæ¯è¿˜æœ‰ï¼š</font><font style="color:rgb(28, 30, 33);"> </font>`**<font style="color:rgb(28, 30, 33);">response_metadata</font>**`<font style="color:rgb(28, 30, 33);"> </font>`<font style="color:rgb(28, 30, 33);">response_metadata</font>`<font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">å±æ€§åŒ…å«æœ‰å…³å“åº”çš„å…¶ä»–å…ƒæ•°æ®ã€‚è¿™é‡Œçš„æ•°æ®é€šå¸¸é’ˆå¯¹æ¯ä¸ªæ¨¡å‹æä¾›è€…å…·ä½“åŒ–ã€‚ è¿™æ˜¯å­˜å‚¨å¯¹æ•°æ¦‚ç‡å’Œæ ‡è®°ä½¿ç”¨ç­‰ä¿¡æ¯çš„åœ°æ–¹ã€‚</font><font style="color:rgb(28, 30, 33);"> </font>`**<font style="color:rgb(28, 30, 33);">tool_calls</font>**`<font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">è¿™äº›è¡¨ç¤ºè¯­è¨€æ¨¡å‹è°ƒç”¨å·¥å…·çš„å†³å®šã€‚å®ƒä»¬ä½œä¸º</font><font style="color:rgb(28, 30, 33);"> </font>`<font style="color:rgb(28, 30, 33);">AIMessage</font>`<font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">è¾“å‡ºçš„ä¸€éƒ¨åˆ†åŒ…å«åœ¨å†…ã€‚ å¯ä»¥é€šè¿‡</font><font style="color:rgb(28, 30, 33);"> </font>`<font style="color:rgb(28, 30, 33);">.tool_calls</font>`<font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">å±æ€§ä»ä¸­è®¿é—®ã€‚ æ­¤å±æ€§è¿”å›ä¸€ä¸ªå­—å…¸åˆ—è¡¨ã€‚æ¯ä¸ªå­—å…¸å…·æœ‰ä»¥ä¸‹é”®ï¼š</font>

+ `<font style="color:rgb(28, 30, 33);">name</font>`<font style="color:rgb(28, 30, 33);">ï¼šåº”è°ƒç”¨çš„å·¥å…·çš„åç§°ã€‚</font>
+ `<font style="color:rgb(28, 30, 33);">args</font>`<font style="color:rgb(28, 30, 33);">ï¼šè¯¥å·¥å…·çš„å‚æ•°ã€‚</font>
+ `<font style="color:rgb(28, 30, 33);">id</font>`<font style="color:rgb(28, 30, 33);">ï¼šè¯¥å·¥å…·è°ƒç”¨çš„ idã€‚</font>

#### <font style="color:rgb(28, 30, 33);">SystemMessage</font>
<font style="color:rgb(28, 30, 33);">è¿™ä»£è¡¨ç³»ç»Ÿæ¶ˆæ¯ï¼Œå‘Šè¯‰æ¨¡å‹å¦‚ä½•è¡Œä¸ºã€‚å¹¶éæ¯ä¸ªæ¨¡å‹æä¾›è€…éƒ½æ”¯æŒè¿™ä¸€ç‚¹ã€‚</font>

#### <font style="color:rgb(28, 30, 33);">FunctionMessage</font>
<font style="color:rgb(28, 30, 33);">è¿™ä»£è¡¨å‡½æ•°è°ƒç”¨çš„ç»“æœã€‚é™¤äº†</font><font style="color:rgb(28, 30, 33);"> </font>`<font style="color:rgb(28, 30, 33);">role</font>`<font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">å’Œ</font><font style="color:rgb(28, 30, 33);"> </font>`<font style="color:rgb(28, 30, 33);">content</font>`<font style="color:rgb(28, 30, 33);">ï¼Œæ­¤æ¶ˆæ¯è¿˜æœ‰ä¸€ä¸ª</font><font style="color:rgb(28, 30, 33);"> </font>`<font style="color:rgb(28, 30, 33);">name</font>`<font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">å‚æ•°ï¼Œä¼ è¾¾äº†ç”Ÿæˆæ­¤ç»“æœæ‰€è°ƒç”¨çš„å‡½æ•°çš„åç§°ã€‚</font>

#### <font style="color:rgb(28, 30, 33);">ToolMessage</font>
<font style="color:rgb(28, 30, 33);">è¿™ä»£è¡¨å·¥å…·è°ƒç”¨çš„ç»“æœã€‚è¿™ä¸ FunctionMessage ä¸åŒï¼Œä»¥åŒ¹é… OpenAI çš„</font><font style="color:rgb(28, 30, 33);"> </font>`<font style="color:rgb(28, 30, 33);">function</font>`<font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">å’Œ</font><font style="color:rgb(28, 30, 33);"> </font>`<font style="color:rgb(28, 30, 33);">tool</font>`<font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">æ¶ˆæ¯ç±»å‹ã€‚é™¤äº†</font><font style="color:rgb(28, 30, 33);"> </font>`<font style="color:rgb(28, 30, 33);">role</font>`<font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">å’Œ</font><font style="color:rgb(28, 30, 33);"> </font>`<font style="color:rgb(28, 30, 33);">content</font>`<font style="color:rgb(28, 30, 33);">ï¼Œæ­¤æ¶ˆæ¯è¿˜æœ‰ä¸€ä¸ª</font><font style="color:rgb(28, 30, 33);"> </font>`<font style="color:rgb(28, 30, 33);">tool_call_id</font>`<font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">å‚æ•°ï¼Œä¼ è¾¾äº†è°ƒç”¨ç”Ÿæˆæ­¤ç»“æœçš„å·¥å…·çš„ idã€‚</font>

### <font style="color:rgb(28, 30, 33);">Prompt templates(æç¤ºæ¨¡æ¿)</font>
<font style="color:rgb(28, 30, 33);">æç¤ºæ¨¡æ¿æœ‰åŠ©äºå°†ç”¨æˆ·è¾“å…¥å’Œå‚æ•°è½¬æ¢ä¸ºè¯­è¨€æ¨¡å‹çš„æŒ‡ä»¤ã€‚ è¿™å¯ç”¨äºå¼•å¯¼æ¨¡å‹çš„å“åº”ï¼Œå¸®åŠ©å…¶ç†è§£ä¸Šä¸‹æ–‡å¹¶ç”Ÿæˆç›¸å…³å’Œè¿è´¯çš„åŸºäºè¯­è¨€çš„è¾“å‡ºã€‚ æç¤ºæ¨¡æ¿ä»¥å­—å…¸ä½œä¸ºè¾“å…¥ï¼Œå…¶ä¸­æ¯ä¸ªé”®ä»£è¡¨è¦å¡«å……çš„æç¤ºæ¨¡æ¿ä¸­çš„å˜é‡ã€‚ æç¤ºæ¨¡æ¿è¾“å‡ºä¸€ä¸ª PromptValueã€‚è¿™ä¸ª PromptValue å¯ä»¥ä¼ é€’ç»™ LLM æˆ– ChatModelï¼Œå¹¶ä¸”è¿˜å¯ä»¥è½¬æ¢ä¸ºå­—ç¬¦ä¸²æˆ–æ¶ˆæ¯åˆ—è¡¨ã€‚ å­˜åœ¨ PromptValue çš„åŸå› æ˜¯ä¸ºäº†æ–¹ä¾¿åœ¨å­—ç¬¦ä¸²å’Œæ¶ˆæ¯ä¹‹é—´åˆ‡æ¢ã€‚ æœ‰å‡ ç§ä¸åŒç±»å‹çš„æç¤ºæ¨¡æ¿</font>

#### <font style="color:rgb(28, 30, 33);">String PromptTemplates</font>
<font style="color:rgb(28, 30, 33);">è¿™äº›æç¤ºæ¨¡æ¿ç”¨äºæ ¼å¼åŒ–å•ä¸ªå­—ç¬¦ä¸²ï¼Œé€šå¸¸ç”¨äºæ›´ç®€å•çš„è¾“å…¥ã€‚ ä¾‹å¦‚ï¼Œæ„å»ºå’Œä½¿ç”¨ PromptTemplate çš„å¸¸è§æ–¹æ³•å¦‚ä¸‹ï¼š</font>

```python
from langchain_core.prompts import PromptTemplate
prompt_template = PromptTemplate.from_template("Tell me a joke about {topic}")
prompt_template.invoke({"topic": "cats"})
```

#### <font style="color:rgb(28, 30, 33);">ChatPromptTemplates</font>
<font style="color:rgb(28, 30, 33);">è¿™äº›æç¤ºæ¨¡æ¿ç”¨äºæ ¼å¼åŒ–æ¶ˆæ¯åˆ—è¡¨ã€‚è¿™äº›â€œæ¨¡æ¿â€æœ¬èº«æ˜¯æ¨¡æ¿åˆ—è¡¨ã€‚ ä¾‹å¦‚ï¼Œæ„å»ºå’Œä½¿ç”¨ ChatPromptTemplate çš„å¸¸è§æ–¹æ³•å¦‚ä¸‹ï¼š</font>

```python
from langchain_core.prompts import ChatPromptTemplate
prompt_template = ChatPromptTemplate.from_messages([
    ("system", "You are a helpful assistant"),
    ("user", "Tell me a joke about {topic}")
])
prompt_template.invoke({"topic": "cats"})
```

<font style="color:rgb(28, 30, 33);">åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œå½“è°ƒç”¨æ­¤ ChatPromptTemplate æ—¶ï¼Œå°†æ„å»ºä¸¤æ¡æ¶ˆæ¯ã€‚ ç¬¬ä¸€æ¡æ˜¯ç³»ç»Ÿæ¶ˆæ¯ï¼Œæ²¡æœ‰è¦æ ¼å¼åŒ–çš„å˜é‡ã€‚ ç¬¬äºŒæ¡æ˜¯ HumanMessageï¼Œå¹¶å°†æ ¹æ®ç”¨æˆ·ä¼ å…¥çš„ </font>`<font style="color:rgb(28, 30, 33);">topic</font>`<font style="color:rgb(28, 30, 33);"> å˜é‡è¿›è¡Œæ ¼å¼åŒ–ã€‚</font>

#### <font style="color:rgb(28, 30, 33);">MessagesPlaceholder</font>
<font style="color:rgb(28, 30, 33);">è¿™ä¸ªæç¤ºæ¨¡æ¿è´Ÿè´£åœ¨ç‰¹å®šä½ç½®æ·»åŠ æ¶ˆæ¯åˆ—è¡¨ã€‚ åœ¨ä¸Šé¢çš„ ChatPromptTemplate ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†å¦‚ä½•æ ¼å¼åŒ–ä¸¤æ¡æ¶ˆæ¯ï¼Œæ¯æ¡æ¶ˆæ¯éƒ½æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚ ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬å¸Œæœ›ç”¨æˆ·ä¼ å…¥ä¸€ä¸ªæ¶ˆæ¯åˆ—è¡¨ï¼Œæˆ‘ä»¬å°†å…¶æ’å…¥åˆ°ç‰¹å®šä½ç½®ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿ è¿™å°±æ˜¯æ‚¨ä½¿ç”¨ MessagesPlaceholder çš„æ–¹å¼ã€‚</font>

```python
from langchain_core.prompts import ChatPromptTemplate, MessagesPlaceholder
from langchain_core.messages import HumanMessage
prompt_template = ChatPromptTemplate.from_messages([
    ("system", "You are a helpful assistant"),
    MessagesPlaceholder("msgs")
])
prompt_template.invoke({"msgs": [HumanMessage(content="hi!")]})
```

<font style="color:rgb(28, 30, 33);">è¿™å°†ç”Ÿæˆä¸¤æ¡æ¶ˆæ¯ï¼Œç¬¬ä¸€æ¡æ˜¯ç³»ç»Ÿæ¶ˆæ¯ï¼Œç¬¬äºŒæ¡æ˜¯æˆ‘ä»¬ä¼ å…¥çš„ HumanMessageã€‚ å¦‚æœæˆ‘ä»¬ä¼ å…¥äº† 5 æ¡æ¶ˆæ¯ï¼Œé‚£ä¹ˆæ€»å…±ä¼šç”Ÿæˆ 6 æ¡æ¶ˆæ¯ï¼ˆç³»ç»Ÿæ¶ˆæ¯åŠ ä¸Šä¼ å…¥çš„ 5 æ¡æ¶ˆæ¯ï¼‰ã€‚ è¿™å¯¹äºå°†ä¸€ç³»åˆ—æ¶ˆæ¯æ’å…¥åˆ°ç‰¹å®šä½ç½®éå¸¸æœ‰ç”¨ã€‚ å¦ä¸€ç§å®ç°ç›¸åŒæ•ˆæœçš„æ›¿ä»£æ–¹æ³•æ˜¯ï¼Œä¸ç›´æ¥ä½¿ç”¨</font><font style="color:rgb(28, 30, 33);"> </font>`<font style="color:rgb(28, 30, 33);">MessagesPlaceholder</font>`<font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">ç±»ï¼Œè€Œæ˜¯ï¼š</font>

```python
prompt_template = ChatPromptTemplate.from_messages([
    ("system", "You are a helpful assistant"),
    ("placeholder", "{msgs}") # <-- è¿™æ˜¯æ›´æ”¹çš„éƒ¨åˆ†
])
```



### <font style="color:rgb(28, 30, 33);">Output parsers(è¾“å‡ºè§£æå™¨)</font>
è¿™é‡Œæåˆ°çš„æ˜¯å°†æ¨¡å‹çš„æ–‡æœ¬è¾“å‡ºè¿›è¡Œè§£æï¼Œè½¬æ¢ä¸ºæ›´ç»“æ„åŒ–è¡¨ç¤ºçš„è§£æå™¨ã€‚ è¶Šæ¥è¶Šå¤šçš„æ¨¡å‹æ”¯æŒå‡½æ•°ï¼ˆæˆ–å·¥å…·ï¼‰è°ƒç”¨ï¼Œå¯ä»¥è‡ªåŠ¨å¤„ç†è¿™ä¸€è¿‡ç¨‹ã€‚ å»ºè®®ä½¿ç”¨å‡½æ•°/å·¥å…·è°ƒç”¨ï¼Œè€Œä¸æ˜¯è¾“å‡ºè§£æã€‚

<font style="color:rgb(28, 30, 33);">è´Ÿè´£æ¥æ”¶æ¨¡å‹çš„è¾“å‡ºå¹¶å°†å…¶è½¬æ¢ä¸ºæ›´é€‚åˆä¸‹æ¸¸ä»»åŠ¡çš„æ ¼å¼ã€‚ åœ¨ä½¿ç”¨LLMsç”Ÿæˆç»“æ„åŒ–æ•°æ®æˆ–è§„èŒƒåŒ–èŠå¤©æ¨¡å‹å’ŒLLMsçš„è¾“å‡ºæ—¶éå¸¸æœ‰ç”¨ã€‚ LangChainæœ‰è®¸å¤šä¸åŒç±»å‹çš„è¾“å‡ºè§£æå™¨ã€‚ä¸‹è¡¨åˆ—å‡ºäº†LangChainæ”¯æŒçš„å„ç§è¾“å‡ºè§£æå™¨åŠç›¸å…³ä¿¡æ¯ï¼š </font>

**<font style="color:rgb(28, 30, 33);">åç§°</font>**<font style="color:rgb(28, 30, 33);">ï¼šè¾“å‡ºè§£æå™¨çš„åç§° </font>

**<font style="color:rgb(28, 30, 33);">æ”¯æŒæµå¼å¤„ç†</font>**<font style="color:rgb(28, 30, 33);">ï¼šè¾“å‡ºè§£æå™¨æ˜¯å¦æ”¯æŒæµå¼å¤„ç† </font>

**<font style="color:rgb(28, 30, 33);">å…·æœ‰æ ¼å¼è¯´æ˜</font>**<font style="color:rgb(28, 30, 33);">ï¼šè¾“å‡ºè§£æå™¨æ˜¯å¦å…·æœ‰æ ¼å¼è¯´æ˜ã€‚é€šå¸¸æ˜¯å¯ç”¨çš„ï¼Œé™¤éåœ¨æç¤ºä¸­æœªæŒ‡å®šæ‰€éœ€æ¨¡å¼ï¼Œè€Œæ˜¯åœ¨å…¶ä»–å‚æ•°ä¸­æŒ‡å®šï¼ˆå¦‚OpenAIå‡½æ•°è°ƒç”¨ï¼‰ï¼Œæˆ–è€…å½“OutputParseråŒ…è£…å¦ä¸€ä¸ªOutputParseræ—¶ã€‚ </font>

**<font style="color:rgb(28, 30, 33);">è°ƒç”¨LLM</font>**<font style="color:rgb(28, 30, 33);">ï¼šæ­¤è¾“å‡ºè§£æå™¨æ˜¯å¦è°ƒç”¨LLMã€‚é€šå¸¸åªæœ‰å°è¯•çº æ­£æ ¼å¼ä¸æ­£ç¡®çš„è¾“å‡ºçš„è¾“å‡ºè§£æå™¨æ‰ä¼šè¿™æ ·åšã€‚ </font>**<font style="color:rgb(28, 30, 33);">è¾“å…¥ç±»å‹</font>**<font style="color:rgb(28, 30, 33);">ï¼šé¢„æœŸçš„è¾“å…¥ç±»å‹ã€‚å¤§å¤šæ•°è¾“å‡ºè§£æå™¨é€‚ç”¨äºå­—ç¬¦ä¸²å’Œæ¶ˆæ¯ï¼Œä½†æœ‰äº›ï¼ˆå¦‚OpenAIå‡½æ•°ï¼‰éœ€è¦å…·æœ‰ç‰¹å®škwargsçš„æ¶ˆæ¯ã€‚</font>

<font style="color:rgb(28, 30, 33);"></font>**<font style="color:rgb(28, 30, 33);">è¾“å‡ºç±»å‹</font>**<font style="color:rgb(28, 30, 33);">ï¼šè§£æå™¨è¿”å›çš„å¯¹è±¡çš„è¾“å‡ºç±»å‹ã€‚</font>

**<font style="color:rgb(28, 30, 33);">æè¿°</font>**<font style="color:rgb(28, 30, 33);">ï¼šæˆ‘ä»¬å¯¹æ­¤è¾“å‡ºè§£æå™¨çš„è¯„è®ºä»¥åŠä½•æ—¶ä½¿ç”¨å®ƒçš„è¯´æ˜ã€‚ </font>

<font style="color:rgb(28, 30, 33);">ç¤ºä¾‹ä»£ç </font>

```python
from langchain_openai import ChatOpenAI
from langchain_core.messages import HumanMessage, SystemMessage
from langchain_core.output_parsers import StrOutputParser

model = ChatOpenAI(model="gpt-4")

messages = [
    SystemMessage(content="å°†ä»¥ä¸‹å†…å®¹ä»è‹±è¯­ç¿»è¯‘æˆä¸­æ–‡"),
    HumanMessage(content="It's a nice day today"),
]
parser = StrOutputParser()
result = model.invoke(messages)
#ä½¿ç”¨parserå¤„ç†modelè¿”å›çš„ç»“æœ
response = parser.invoke(result)
print(response)
#ä»Šå¤©å¤©æ°”å¾ˆå¥½
```



### Chains(é“¾å¼è°ƒç”¨)
Chains æ˜¯ LangChain ä¸­ç”¨äºå°†å¤šä¸ªæ­¥éª¤ç»„åˆæˆä¸€ä¸ªå·¥ä½œæµç¨‹çš„æ¨¡å—ã€‚å®ƒä»¬å…è®¸ä½ å®šä¹‰ä¸€ç³»åˆ—æ“ä½œï¼Œå¹¶å°†å®ƒä»¬é“¾æ¥åœ¨ä¸€èµ·ã€‚æ¯”å¦‚<font style="color:rgb(28, 30, 33);">åœ¨è¿™ä¸ªChainä¸­ï¼Œæ¯æ¬¡éƒ½ä¼šè°ƒç”¨è¾“å‡ºè§£æå™¨ã€‚è¿™ä¸ªé“¾æ¡çš„è¾“å…¥ç±»å‹æ˜¯è¯­è¨€æ¨¡å‹çš„è¾“å‡ºï¼ˆå­—ç¬¦ä¸²æˆ–æ¶ˆæ¯åˆ—è¡¨ï¼‰ï¼Œè¾“å‡ºç±»å‹æ˜¯è¾“å‡ºè§£æå™¨çš„è¾“å‡ºï¼ˆå­—ç¬¦ä¸²ï¼‰ã€‚</font>

<font style="color:rgb(28, 30, 33);">æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ </font>`<font style="color:rgb(28, 30, 33);">|</font>`<font style="color:rgb(28, 30, 33);"> è¿ç®—ç¬¦è½»æ¾åˆ›å»ºè¿™ä¸ªChainã€‚</font>`<font style="color:rgb(28, 30, 33);">|</font>`<font style="color:rgb(28, 30, 33);"> è¿ç®—ç¬¦åœ¨ LangChain ä¸­ç”¨äºå°†ä¸¤ä¸ªå…ƒç´ ç»„åˆåœ¨ä¸€èµ·ã€‚</font>

<font style="color:rgb(28, 30, 33);">å¦‚æœæˆ‘ä»¬ç°åœ¨çœ‹ä¸€ä¸‹ LangSmithï¼Œæˆ‘ä»¬ä¼šå‘ç°è¿™ä¸ªé“¾æ¡æœ‰ä¸¤ä¸ªæ­¥éª¤ï¼šé¦–å…ˆè°ƒç”¨è¯­è¨€æ¨¡å‹ï¼Œç„¶åå°†å…¶ç»“æœä¼ é€’ç»™è¾“å‡ºè§£æå™¨ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ </font>[<font style="color:rgb(28, 30, 33);">LangSmith è·Ÿè¸ª</font>](https://smith.langchain.com/public/f1bdf656-2739-42f7-ac7f-0f1dd712322f/r)<font style="color:rgb(28, 30, 33);"> ä¸­çœ‹åˆ°è¿™ä¸€ç‚¹ã€‚	</font>

[https://smith.langchain.com/public/f1bdf656-2739-42f7-ac7f-0f1dd712322f/r](https://smith.langchain.com/public/f1bdf656-2739-42f7-ac7f-0f1dd712322f/r)

ç¤ºä¾‹ä»£ç 

```python
from langchain_openai import ChatOpenAI
from langchain_core.messages import HumanMessage, SystemMessage
from langchain_core.output_parsers import StrOutputParser

model = ChatOpenAI(model="gpt-4")

messages = [
    SystemMessage(content="å°†ä»¥ä¸‹å†…å®¹ä»è‹±è¯­ç¿»è¯‘æˆä¸­æ–‡"),
    HumanMessage(content="Let's go for a run"),
]
parser = StrOutputParser()

# ä½¿ç”¨Chainsæ–¹å¼è°ƒç”¨
chain = model | parser  #ç­‰äº model.invoke() + parser.invoke()
response = chain.invoke(messages)
print(response)
#æˆ‘ä»¬å»è·‘æ­¥å§

```



## LCEL & Runable interface
LCEL è‹±æ–‡å…¨ç§° LangChain Execution Languageï¼ˆ<font style="color:rgb(28, 30, 33);">LangChain è¡¨è¾¾è¯­è¨€ï¼‰  </font><font style="color:rgb(28, 30, 33);">æ˜¯ä¸€ç§å£°æ˜æ€§çš„æ–¹å¼æ¥é“¾æ¥ LangChain ç»„ä»¶ã€‚ LCEL ä»ç¬¬ä¸€å¤©èµ·å°±è¢«è®¾è®¡ä¸º</font>**<font style="color:rgb(28, 30, 33);">æ”¯æŒå°†åŸå‹æŠ•å…¥ç”Ÿäº§ï¼Œæ— éœ€æ›´æ”¹ä»£ç </font>**<font style="color:rgb(28, 30, 33);">ï¼Œä»æœ€ç®€å•çš„â€œæç¤º + LLMâ€é“¾åˆ°æœ€å¤æ‚çš„é“¾ï¼ˆæˆ‘ä»¬å·²ç»çœ‹åˆ°æœ‰äººæˆåŠŸåœ°åœ¨ç”Ÿäº§ä¸­è¿è¡Œäº†åŒ…å«æ•°ç™¾æ­¥çš„ LCEL é“¾ï¼‰ã€‚ä»¥ä¸‹æ˜¯æ‚¨å¯èƒ½æƒ³è¦ä½¿ç”¨ LCEL çš„ä¸€äº›åŸå› çš„å‡ ä¸ªäº®ç‚¹ï¼š</font>

**<font style="color:rgb(28, 30, 33);">ä¸€æµçš„æµå¼æ”¯æŒ</font>**<font style="color:rgb(28, 30, 33);"> å½“æ‚¨ä½¿ç”¨ LCEL æ„å»ºé“¾æ—¶ï¼Œæ‚¨å°†è·å¾—å¯èƒ½çš„æœ€ä½³æ—¶é—´åˆ°ç¬¬ä¸€ä¸ªæ ‡è®°ï¼ˆç›´åˆ°è¾“å‡ºçš„ç¬¬ä¸€å—å†…å®¹å‡ºç°æ‰€ç»è¿‡çš„æ—¶é—´ï¼‰ã€‚å¯¹äºæŸäº›é“¾ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬ç›´æ¥ä» LLM æµå¼ä¼ è¾“æ ‡è®°åˆ°æµå¼è¾“å‡ºè§£æå™¨ï¼Œæ‚¨å°†ä»¥ä¸ LLM æä¾›ç¨‹åºè¾“å‡ºåŸå§‹æ ‡è®°çš„é€Ÿç‡ç›¸åŒçš„é€Ÿåº¦è·å¾—è§£æçš„å¢é‡è¾“å‡ºå—ã€‚ </font>

**<font style="color:rgb(28, 30, 33);">å¼‚æ­¥æ”¯æŒ</font>**<font style="color:rgb(28, 30, 33);"> ä½¿ç”¨ LCEL æ„å»ºçš„ä»»ä½•é“¾éƒ½å¯ä»¥ä½¿ç”¨åŒæ­¥ APIï¼ˆä¾‹å¦‚ï¼Œåœ¨æ‚¨çš„ Jupyter ç¬”è®°æœ¬ä¸­è¿›è¡ŒåŸå‹è®¾è®¡ï¼‰ä»¥åŠå¼‚æ­¥ APIï¼ˆä¾‹å¦‚ï¼Œåœ¨ </font>[<font style="color:rgb(28, 30, 33);">LangServe</font>](http://www.aidoczh.com/langchain/v0.2/docs/langserve/)<font style="color:rgb(28, 30, 33);"> æœåŠ¡å™¨ä¸­ï¼‰è¿›è¡Œè°ƒç”¨ã€‚è¿™ä½¿å¾—å¯ä»¥åœ¨åŸå‹å’Œç”Ÿäº§ä¸­ä½¿ç”¨ç›¸åŒçš„ä»£ç ï¼Œå…·æœ‰å‡ºè‰²çš„æ€§èƒ½ï¼Œå¹¶ä¸”èƒ½å¤Ÿåœ¨åŒä¸€æœåŠ¡å™¨ä¸­å¤„ç†è®¸å¤šå¹¶å‘è¯·æ±‚ã€‚ </font>

**<font style="color:rgb(28, 30, 33);">ä¼˜åŒ–çš„å¹¶è¡Œæ‰§è¡Œ</font>**<font style="color:rgb(28, 30, 33);"> æ¯å½“æ‚¨çš„ LCEL é“¾å…·æœ‰å¯ä»¥å¹¶è¡Œæ‰§è¡Œçš„æ­¥éª¤æ—¶ï¼ˆä¾‹å¦‚ï¼Œå¦‚æœæ‚¨ä»å¤šä¸ªæ£€ç´¢å™¨ä¸­è·å–æ–‡æ¡£ï¼‰ï¼Œæˆ‘ä»¬ä¼šè‡ªåŠ¨æ‰§è¡Œï¼Œæ— è®ºæ˜¯åœ¨åŒæ­¥æ¥å£è¿˜æ˜¯å¼‚æ­¥æ¥å£ä¸­ï¼Œä»¥è·å¾—å¯èƒ½çš„æœ€å°å»¶è¿Ÿã€‚ </font>

**<font style="color:rgb(28, 30, 33);">é‡è¯•å’Œå›é€€</font>**<font style="color:rgb(28, 30, 33);"> ä¸º LCEL é“¾çš„ä»»ä½•éƒ¨åˆ†é…ç½®é‡è¯•å’Œå›é€€ã€‚è¿™æ˜¯ä½¿æ‚¨çš„é“¾åœ¨è§„æ¨¡ä¸Šæ›´å¯é çš„å¥½æ–¹æ³•ã€‚æˆ‘ä»¬ç›®å‰æ­£åœ¨åŠªåŠ›ä¸ºé‡è¯•/å›é€€æ·»åŠ æµå¼æ”¯æŒï¼Œè¿™æ ·æ‚¨å°±å¯ä»¥è·å¾—é¢å¤–çš„å¯é æ€§è€Œæ— éœ€ä»»ä½•å»¶è¿Ÿæˆæœ¬ã€‚ </font>

**<font style="color:rgb(28, 30, 33);">è®¿é—®ä¸­é—´ç»“æœ</font>**<font style="color:rgb(28, 30, 33);"> å¯¹äºæ›´å¤æ‚çš„é“¾ï¼Œè®¿é—®ä¸­é—´æ­¥éª¤çš„ç»“æœé€šå¸¸éå¸¸æœ‰ç”¨ï¼Œå³ä½¿åœ¨ç”Ÿæˆæœ€ç»ˆè¾“å‡ºä¹‹å‰ã€‚è¿™å¯ä»¥ç”¨äºè®©æœ€ç»ˆç”¨æˆ·çŸ¥é“æ­£åœ¨å‘ç”Ÿçš„äº‹æƒ…ï¼Œç”šè‡³åªæ˜¯ç”¨äºè°ƒè¯•æ‚¨çš„é“¾ã€‚æ‚¨å¯ä»¥æµå¼ä¼ è¾“ä¸­é—´ç»“æœï¼Œå¹¶ä¸”åœ¨æ¯ä¸ª </font>[<font style="color:rgb(28, 30, 33);">LangServe</font>](http://www.aidoczh.com/langchain/v0.2/docs/langserve/)<font style="color:rgb(28, 30, 33);"> æœåŠ¡å™¨ä¸Šéƒ½å¯ä»¥ä½¿ç”¨ã€‚ </font>

**<font style="color:rgb(28, 30, 33);">è¾“å…¥å’Œè¾“å‡ºæ¨¡å¼</font>**<font style="color:rgb(28, 30, 33);"> è¾“å…¥å’Œè¾“å‡ºæ¨¡å¼ä¸ºæ¯ä¸ª LCEL é“¾æä¾›äº†ä»é“¾çš„ç»“æ„æ¨æ–­å‡ºçš„ Pydantic å’Œ JSONSchema æ¨¡å¼ã€‚è¿™å¯ç”¨äºéªŒè¯è¾“å…¥å’Œè¾“å‡ºï¼Œå¹¶ä¸”æ˜¯ LangServe çš„ä¸€ä¸ªç»„æˆéƒ¨åˆ†ã€‚</font>

[**<font style="color:rgb(28, 30, 33);">æ— ç¼ LangSmith è¿½è¸ª</font>**](https://docs.smith.langchain.com/)**<font style="color:rgb(28, 30, 33);"> </font>**<font style="color:rgb(28, 30, 33);">éšç€æ‚¨çš„é“¾å˜å¾—è¶Šæ¥è¶Šå¤æ‚ï¼Œå‡†ç¡®ç†è§£æ¯ä¸€æ­¥å‘ç”Ÿçš„äº‹æƒ…å˜å¾—è¶Šæ¥è¶Šé‡è¦ã€‚ ä½¿ç”¨ LCELï¼Œ</font>**<font style="color:rgb(28, 30, 33);">æ‰€æœ‰</font>**<font style="color:rgb(28, 30, 33);">æ­¥éª¤éƒ½ä¼šè‡ªåŠ¨è®°å½•åˆ° </font>[<font style="color:rgb(28, 30, 33);">LangSmith</font>](https://docs.smith.langchain.com/)<font style="color:rgb(28, 30, 33);"> ä¸­ï¼Œä»¥å®ç°æœ€å¤§çš„å¯è§‚å¯Ÿæ€§å’Œå¯è°ƒè¯•æ€§ã€‚</font>

<font style="color:rgb(28, 30, 33);"> </font>[**<font style="color:rgb(28, 30, 33);">æ— ç¼ LangServe éƒ¨ç½²</font>**](http://www.aidoczh.com/langchain/v0.2/docs/langserve/)**<font style="color:rgb(28, 30, 33);"> </font>**<font style="color:rgb(28, 30, 33);">ä½¿ç”¨ LCEL åˆ›å»ºçš„ä»»ä½•é“¾éƒ½å¯ä»¥è½»æ¾åœ°é€šè¿‡ </font>[<font style="color:rgb(28, 30, 33);">LangServe</font>](http://www.aidoczh.com/langchain/v0.2/docs/langserve/)<font style="color:rgb(28, 30, 33);"> éƒ¨ç½²ã€‚</font>

### <font style="color:rgb(28, 30, 33);">Runable interface(å¯è¿è¡Œæ¥å£)</font>
<font style="color:rgb(28, 30, 33);">ä¸ºäº†å°½å¯èƒ½ç®€åŒ–åˆ›å»ºè‡ªå®šä¹‰é“¾çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬å®ç°äº†ä¸€ä¸ª</font><font style="color:rgb(28, 30, 33);"> </font>[<font style="color:rgb(28, 30, 33);">"Runnable"</font>](https://api.python.langchain.com/en/stable/runnables/langchain_core.runnables.base.Runnable.html#langchain_core.runnables.base.Runnable)<font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">åè®®ã€‚è®¸å¤š LangChain ç»„ä»¶éƒ½å®ç°äº†</font><font style="color:rgb(28, 30, 33);"> </font>`<font style="color:rgb(28, 30, 33);">Runnable</font>`<font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">åè®®ï¼ŒåŒ…æ‹¬èŠå¤©æ¨¡å‹ã€LLMsã€è¾“å‡ºè§£æå™¨ã€æ£€ç´¢å™¨ã€æç¤ºæ¨¡æ¿ç­‰ç­‰ã€‚æ­¤å¤–ï¼Œè¿˜æœ‰ä¸€äº›æœ‰ç”¨çš„åŸºæœ¬ç»„ä»¶å¯ç”¨äºå¤„ç†å¯è¿è¡Œå¯¹è±¡ï¼Œæ‚¨å¯ä»¥åœ¨ä¸‹é¢äº†è§£æ›´å¤šã€‚ è¿™æ˜¯ä¸€ä¸ªæ ‡å‡†æ¥å£ï¼Œå¯ä»¥è½»æ¾å®šä¹‰è‡ªå®šä¹‰é“¾ï¼Œå¹¶ä»¥æ ‡å‡†æ–¹å¼è°ƒç”¨å®ƒä»¬ã€‚ æ ‡å‡†æ¥å£åŒ…æ‹¬ï¼š</font>

+ [<font style="color:rgb(28, 30, 33);">stream</font>](http://www.aidoczh.com/langchain/v0.2/docs/concepts/#stream)<font style="color:rgb(28, 30, 33);">: è¿”å›å“åº”çš„æ•°æ®å—</font>
+ [<font style="color:rgb(28, 30, 33);">invoke</font>](http://www.aidoczh.com/langchain/v0.2/docs/concepts/#invoke)<font style="color:rgb(28, 30, 33);">: å¯¹è¾“å…¥è°ƒç”¨é“¾</font>
+ [<font style="color:rgb(28, 30, 33);">batch</font>](http://www.aidoczh.com/langchain/v0.2/docs/concepts/#batch)<font style="color:rgb(28, 30, 33);">: å¯¹è¾“å…¥åˆ—è¡¨è°ƒç”¨é“¾ </font>

<font style="color:rgb(28, 30, 33);">è¿™äº›è¿˜æœ‰ç›¸åº”çš„å¼‚æ­¥æ–¹æ³•ï¼Œåº”è¯¥ä¸ </font>[<font style="color:rgb(28, 30, 33);">asyncio</font>](https://docs.python.org/3/library/asyncio.html)<font style="color:rgb(28, 30, 33);"> ä¸€èµ·ä½¿ç”¨ </font>`<font style="color:rgb(28, 30, 33);">await</font>`<font style="color:rgb(28, 30, 33);"> è¯­æ³•ä»¥å®ç°å¹¶å‘ï¼š</font>

+ `<font style="color:rgb(28, 30, 33);">astream</font>`<font style="color:rgb(28, 30, 33);">: å¼‚æ­¥è¿”å›å“åº”çš„æ•°æ®å—</font>
+ `<font style="color:rgb(28, 30, 33);">ainvoke</font>`<font style="color:rgb(28, 30, 33);">: å¼‚æ­¥å¯¹è¾“å…¥è°ƒç”¨é“¾</font>
+ `<font style="color:rgb(28, 30, 33);">abatch</font>`<font style="color:rgb(28, 30, 33);">: å¼‚æ­¥å¯¹è¾“å…¥åˆ—è¡¨è°ƒç”¨é“¾</font>
+ `<font style="color:rgb(28, 30, 33);">astream_log</font>`<font style="color:rgb(28, 30, 33);">: å¼‚æ­¥è¿”å›ä¸­é—´æ­¥éª¤ï¼Œä»¥åŠæœ€ç»ˆå“åº”</font>
+ `<font style="color:rgb(28, 30, 33);">astream_events</font>`<font style="color:rgb(28, 30, 33);">:</font><font style="color:rgb(28, 30, 33);"> </font>**<font style="color:rgb(28, 30, 33);">beta</font>**<font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">æµå¼ä¼ è¾“é“¾ä¸­å‘ç”Ÿçš„äº‹ä»¶ï¼ˆåœ¨</font><font style="color:rgb(28, 30, 33);"> </font>`<font style="color:rgb(28, 30, 33);">langchain-core</font>`<font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">0.1.14 ä¸­å¼•å…¥ï¼‰</font><font style="color:rgb(28, 30, 33);"> </font>

**<font style="color:rgb(28, 30, 33);">è¾“å…¥ç±»å‹</font>**<font style="color:rgb(28, 30, 33);"> å’Œ </font>**<font style="color:rgb(28, 30, 33);">è¾“å‡ºç±»å‹</font>**<font style="color:rgb(28, 30, 33);"> å› ç»„ä»¶è€Œå¼‚ï¼š </font>

| <font style="color:rgb(28, 30, 33);">ç»„ä»¶</font> | <font style="color:rgb(28, 30, 33);">è¾“å…¥ç±»å‹</font> | <font style="color:rgb(28, 30, 33);">è¾“å‡ºç±»å‹</font> |
| --- | --- | --- |
| <font style="color:rgb(28, 30, 33);">æç¤º</font> | <font style="color:rgb(28, 30, 33);">å­—å…¸</font> | <font style="color:rgb(28, 30, 33);">æç¤ºå€¼</font> |
| <font style="color:rgb(28, 30, 33);">èŠå¤©æ¨¡å‹</font> | <font style="color:rgb(28, 30, 33);">å•ä¸ªå­—ç¬¦ä¸²ã€èŠå¤©æ¶ˆæ¯åˆ—è¡¨æˆ–æç¤ºå€¼</font> | <font style="color:rgb(28, 30, 33);">èŠå¤©æ¶ˆæ¯</font> |
| <font style="color:rgb(28, 30, 33);">LLM</font> | <font style="color:rgb(28, 30, 33);">å•ä¸ªå­—ç¬¦ä¸²ã€èŠå¤©æ¶ˆæ¯åˆ—è¡¨æˆ–æç¤ºå€¼</font> | <font style="color:rgb(28, 30, 33);">å­—ç¬¦ä¸²</font> |
| <font style="color:rgb(28, 30, 33);">è¾“å‡ºè§£æå™¨</font> | <font style="color:rgb(28, 30, 33);">LLM æˆ–èŠå¤©æ¨¡å‹çš„è¾“å‡º</font> | <font style="color:rgb(28, 30, 33);">å–å†³äºè§£æå™¨</font> |
| <font style="color:rgb(28, 30, 33);">æ£€ç´¢å™¨</font> | <font style="color:rgb(28, 30, 33);">å•ä¸ªå­—ç¬¦ä¸²</font> | <font style="color:rgb(28, 30, 33);">æ–‡æ¡£åˆ—è¡¨</font> |
| <font style="color:rgb(28, 30, 33);">å·¥å…·</font> | <font style="color:rgb(28, 30, 33);">å•ä¸ªå­—ç¬¦ä¸²æˆ–å­—å…¸ï¼Œå–å†³äºå·¥å…·</font> | <font style="color:rgb(28, 30, 33);">å–å†³äºå·¥å…·</font> |


<font style="color:rgb(28, 30, 33);">æ‰€æœ‰å¯è¿è¡Œå¯¹è±¡éƒ½å…¬å¼€è¾“å…¥å’Œè¾“å‡º </font>**<font style="color:rgb(28, 30, 33);">æ¨¡å¼</font>**<font style="color:rgb(28, 30, 33);"> ä»¥æ£€æŸ¥è¾“å…¥å’Œè¾“å‡ºï¼š</font>

+ `<font style="color:rgb(28, 30, 33);">input_schema</font>`<font style="color:rgb(28, 30, 33);">: ä»å¯è¿è¡Œå¯¹è±¡ç»“æ„è‡ªåŠ¨ç”Ÿæˆçš„è¾“å…¥ Pydantic æ¨¡å‹</font>
+ `<font style="color:rgb(28, 30, 33);">output_schema</font>`<font style="color:rgb(28, 30, 33);">: ä»å¯è¿è¡Œå¯¹è±¡ç»“æ„è‡ªåŠ¨ç”Ÿæˆçš„è¾“å‡º Pydantic æ¨¡å‹</font>



<font style="color:rgb(28, 30, 33);">æµå¼è¿è¡Œå¯¹äºä½¿åŸºäº LLM çš„åº”ç”¨ç¨‹åºå¯¹æœ€ç»ˆç”¨æˆ·å…·æœ‰å“åº”æ€§è‡³å…³é‡è¦ã€‚ é‡è¦çš„ LangChain åŸè¯­ï¼Œå¦‚</font>[<font style="color:rgb(28, 30, 33);">èŠå¤©æ¨¡å‹</font>](http://www.aidoczh.com/langchain/v0.2/docs/concepts/#chat-models)<font style="color:rgb(28, 30, 33);">ã€</font>[<font style="color:rgb(28, 30, 33);">è¾“å‡ºè§£æå™¨</font>](http://www.aidoczh.com/langchain/v0.2/docs/concepts/#output-parsers)<font style="color:rgb(28, 30, 33);">ã€</font>[<font style="color:rgb(28, 30, 33);">æç¤ºæ¨¡æ¿</font>](http://www.aidoczh.com/langchain/v0.2/docs/concepts/#prompt-templates)<font style="color:rgb(28, 30, 33);">ã€</font>[<font style="color:rgb(28, 30, 33);">æ£€ç´¢å™¨</font>](http://www.aidoczh.com/langchain/v0.2/docs/concepts/#retrievers)<font style="color:rgb(28, 30, 33);">å’Œ</font>[<font style="color:rgb(28, 30, 33);">ä»£ç†</font>](http://www.aidoczh.com/langchain/v0.2/docs/concepts/#agents)<font style="color:rgb(28, 30, 33);">éƒ½å®ç°äº† LangChain</font><font style="color:rgb(28, 30, 33);"> </font>[<font style="color:rgb(28, 30, 33);">Runnable æ¥å£</font>](http://www.aidoczh.com/langchain/v0.2/docs/concepts/#interface)<font style="color:rgb(28, 30, 33);">ã€‚ è¯¥æ¥å£æä¾›äº†ä¸¤ç§é€šç”¨çš„æµå¼å†…å®¹æ–¹æ³•ï¼š</font>

1. <font style="color:rgb(28, 30, 33);">åŒæ­¥</font><font style="color:rgb(28, 30, 33);"> </font>`<font style="color:rgb(28, 30, 33);">stream</font>`<font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">å’Œå¼‚æ­¥</font><font style="color:rgb(28, 30, 33);"> </font>`<font style="color:rgb(28, 30, 33);">astream</font>`<font style="color:rgb(28, 30, 33);">ï¼šæµå¼ä¼ è¾“é“¾ä¸­çš„</font>**<font style="color:rgb(28, 30, 33);">æœ€ç»ˆè¾“å‡º</font>**<font style="color:rgb(28, 30, 33);">çš„</font>**<font style="color:rgb(28, 30, 33);">é»˜è®¤å®ç°</font>**<font style="color:rgb(28, 30, 33);">ã€‚</font>
2. <font style="color:rgb(28, 30, 33);">å¼‚æ­¥</font><font style="color:rgb(28, 30, 33);"> </font>`<font style="color:rgb(28, 30, 33);">astream_events</font>`<font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">å’Œå¼‚æ­¥</font><font style="color:rgb(28, 30, 33);"> </font>`<font style="color:rgb(28, 30, 33);">astream_log</font>`<font style="color:rgb(28, 30, 33);">ï¼šè¿™äº›æ–¹æ³•æä¾›äº†ä¸€ç§ä»é“¾ä¸­æµå¼ä¼ è¾“</font>**<font style="color:rgb(28, 30, 33);">ä¸­é—´æ­¥éª¤</font>**<font style="color:rgb(28, 30, 33);">å’Œ</font>**<font style="color:rgb(28, 30, 33);">æœ€ç»ˆè¾“å‡º</font>**<font style="color:rgb(28, 30, 33);">çš„æ–¹å¼ã€‚ è®©æˆ‘ä»¬çœ‹çœ‹è¿™ä¸¤ç§æ–¹æ³•ï¼Œå¹¶å°è¯•ç†è§£å¦‚ä½•ä½¿ç”¨å®ƒä»¬ã€‚</font>

### <font style="color:rgb(28, 30, 33);">Stream(æµ)</font>
<font style="color:rgb(28, 30, 33);">æ‰€æœ‰</font><font style="color:rgb(28, 30, 33);"> </font>`<font style="color:rgb(28, 30, 33);">Runnable</font>`<font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">å¯¹è±¡éƒ½å®ç°äº†ä¸€ä¸ªåä¸º</font><font style="color:rgb(28, 30, 33);"> </font>`<font style="color:rgb(28, 30, 33);">stream</font>`<font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">çš„åŒæ­¥æ–¹æ³•å’Œä¸€ä¸ªåä¸º</font><font style="color:rgb(28, 30, 33);"> </font>`<font style="color:rgb(28, 30, 33);">astream</font>`<font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">çš„å¼‚æ­¥å˜ä½“ã€‚ è¿™äº›æ–¹æ³•æ—¨åœ¨ä»¥å—çš„å½¢å¼æµå¼ä¼ è¾“æœ€ç»ˆè¾“å‡ºï¼Œå°½å¿«è¿”å›æ¯ä¸ªå—ã€‚ åªæœ‰åœ¨ç¨‹åºä¸­çš„æ‰€æœ‰æ­¥éª¤éƒ½çŸ¥é“å¦‚ä½•å¤„ç†</font>**<font style="color:rgb(28, 30, 33);">è¾“å…¥æµ</font>**<font style="color:rgb(28, 30, 33);">æ—¶ï¼Œæ‰èƒ½è¿›è¡Œæµå¼ä¼ è¾“ï¼›å³ï¼Œé€ä¸ªå¤„ç†è¾“å…¥å—ï¼Œå¹¶äº§ç”Ÿç›¸åº”çš„è¾“å‡ºå—ã€‚ è¿™ç§å¤„ç†çš„å¤æ‚æ€§å¯ä»¥æœ‰æ‰€ä¸åŒï¼Œä»ç®€å•çš„ä»»åŠ¡ï¼Œå¦‚å‘å‡º LLM ç”Ÿæˆçš„ä»¤ç‰Œï¼Œåˆ°æ›´å…·æŒ‘æˆ˜æ€§çš„ä»»åŠ¡ï¼Œå¦‚åœ¨æ•´ä¸ª JSON å®Œæˆä¹‹å‰æµå¼ä¼ è¾“ JSON ç»“æœçš„éƒ¨åˆ†ã€‚ å¼€å§‹æ¢ç´¢æµå¼ä¼ è¾“çš„æœ€ä½³æ–¹æ³•æ˜¯ä» LLM åº”ç”¨ç¨‹åºä¸­æœ€é‡è¦çš„ç»„ä»¶å¼€å§‹â€”â€”LLM æœ¬èº«ï¼</font>

#### <font style="color:rgb(28, 30, 33);">LLM å’ŒèŠå¤©æ¨¡å‹</font>
<font style="color:rgb(28, 30, 33);">å¤§å‹è¯­è¨€æ¨¡å‹åŠå…¶èŠå¤©å˜ä½“æ˜¯åŸºäº LLM çš„åº”ç”¨ç¨‹åºçš„ä¸»è¦ç“¶é¢ˆã€‚ å¤§å‹è¯­è¨€æ¨¡å‹å¯èƒ½éœ€è¦</font>**<font style="color:rgb(28, 30, 33);">å‡ ç§’é’Ÿ</font>**<font style="color:rgb(28, 30, 33);">æ‰èƒ½å¯¹æŸ¥è¯¢ç”Ÿæˆå®Œæ•´çš„å“åº”ã€‚è¿™æ¯”åº”ç”¨ç¨‹åºå¯¹æœ€ç»ˆç”¨æˆ·å…·æœ‰å“åº”æ€§çš„</font>**<font style="color:rgb(28, 30, 33);">çº¦ 200-300 æ¯«ç§’</font>**<font style="color:rgb(28, 30, 33);">çš„é˜ˆå€¼è¦æ…¢å¾—å¤šã€‚ ä½¿åº”ç”¨ç¨‹åºå…·æœ‰æ›´é«˜çš„å“åº”æ€§çš„å…³é”®ç­–ç•¥æ˜¯æ˜¾ç¤ºä¸­é—´è¿›åº¦ï¼›å³ï¼Œé€ä¸ªä»¤ç‰Œæµå¼ä¼ è¾“æ¨¡å‹çš„è¾“å‡ºã€‚ æˆ‘ä»¬å°†å±•ç¤ºä½¿ç”¨èŠå¤©æ¨¡å‹è¿›è¡Œæµå¼ä¼ è¾“çš„ç¤ºä¾‹ã€‚ä»ä»¥ä¸‹é€‰é¡¹ä¸­é€‰æ‹©ä¸€ä¸ªï¼š</font>

<font style="color:rgb(28, 30, 33);">è®©æˆ‘ä»¬ä»åŒæ­¥</font><font style="color:rgb(28, 30, 33);"> </font>`<font style="color:rgb(28, 30, 33);">stream</font>`<font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">API å¼€å§‹ï¼š</font>

```python
chunks = []
for chunk in model.stream("å¤©ç©ºæ˜¯ä»€ä¹ˆé¢œè‰²ï¼Ÿ"):
    chunks.append(chunk)
    print(chunk.content, end="|", flush=True)
```

```plain
å¤©|ç©º|æ˜¯|ä»€|ä¹ˆ|é¢œ|è‰²|ï¼Ÿ|
```

<font style="color:rgb(28, 30, 33);">æˆ–è€…ï¼Œå¦‚æœæ‚¨åœ¨å¼‚æ­¥ç¯å¢ƒä¸­å·¥ä½œï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨å¼‚æ­¥</font><font style="color:rgb(28, 30, 33);"> </font>`<font style="color:rgb(28, 30, 33);">astream</font>`<font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">APIï¼š</font>

```python
chunks = []
async for chunk in model.astream("å¤©ç©ºæ˜¯ä»€ä¹ˆé¢œè‰²ï¼Ÿ"):
    chunks.append(chunk)
    print(chunk.content, end="|", flush=True)
```

```plain
å¤©|ç©º|æ˜¯|ä»€|ä¹ˆ|é¢œ|è‰²|ï¼Ÿ|
```

<font style="color:rgb(28, 30, 33);">è®©æˆ‘ä»¬æ£€æŸ¥å…¶ä¸­ä¸€ä¸ªå—ï¼š</font>

```python
chunks[1]
```

```plain
AIMessageChunk(content='å¤©', id='run-b36bea64-5511-4d7a-b6a3-a07b3db0c8e7')
```

<font style="color:rgb(28, 30, 33);">æˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ªç§°ä¸º</font><font style="color:rgb(28, 30, 33);"> </font>`<font style="color:rgb(28, 30, 33);">AIMessageChunk</font>`<font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">çš„ä¸œè¥¿ã€‚è¯¥å—è¡¨ç¤º</font><font style="color:rgb(28, 30, 33);"> </font>`<font style="color:rgb(28, 30, 33);">AIMessage</font>`<font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">çš„ä¸€éƒ¨åˆ†ã€‚ æ¶ˆæ¯å—æ˜¯å¯å åŠ çš„â€”â€”å¯ä»¥ç®€å•åœ°å°†å®ƒä»¬ç›¸åŠ ä»¥è·å¾—åˆ°ç›®å‰ä¸ºæ­¢çš„å“åº”çŠ¶æ€ï¼</font>

```python
chunks[0] + chunks[1] + chunks[2] + chunks[3] + chunks[4]
```

```plain
AIMessageChunk(content='å¤©ç©ºæ˜¯ä»€ä¹ˆé¢œè‰²', id='run-b36bea64-5511-4d7a-b6a3-a07b3db0c8e7')
```

#### <font style="color:rgb(28, 30, 33);">Chain(é“¾)</font>
<font style="color:rgb(28, 30, 33);">å‡ ä¹æ‰€æœ‰çš„ LLM åº”ç”¨ç¨‹åºéƒ½æ¶‰åŠä¸æ­¢ä¸€æ­¥çš„æ“ä½œï¼Œè€Œä¸ä»…ä»…æ˜¯è°ƒç”¨è¯­è¨€æ¨¡å‹ã€‚ è®©æˆ‘ä»¬ä½¿ç”¨ </font>`<font style="color:rgb(28, 30, 33);">LangChain è¡¨è¾¾å¼è¯­è¨€</font>`<font style="color:rgb(28, 30, 33);"> (</font>`<font style="color:rgb(28, 30, 33);">LCEL</font>`<font style="color:rgb(28, 30, 33);">) æ„å»ºä¸€ä¸ªç®€å•çš„é“¾ï¼Œè¯¥é“¾ç»“åˆäº†ä¸€ä¸ªæç¤ºã€æ¨¡å‹å’Œè§£æå™¨ï¼Œå¹¶éªŒè¯æµå¼ä¼ è¾“æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚ æˆ‘ä»¬å°†ä½¿ç”¨ </font>[<font style="color:rgb(28, 30, 33);">StrOutputParser</font>](https://api.python.langchain.com/en/latest/output_parsers/langchain_core.output_parsers.string.StrOutputParser.html)<font style="color:rgb(28, 30, 33);"> æ¥è§£ææ¨¡å‹çš„è¾“å‡ºã€‚è¿™æ˜¯ä¸€ä¸ªç®€å•çš„è§£æå™¨ï¼Œä» </font>`<font style="color:rgb(28, 30, 33);">AIMessageChunk</font>`<font style="color:rgb(28, 30, 33);"> ä¸­æå– </font>`<font style="color:rgb(28, 30, 33);">content</font>`<font style="color:rgb(28, 30, 33);"> å­—æ®µï¼Œç»™å‡ºæ¨¡å‹è¿”å›çš„ </font>`<font style="color:rgb(28, 30, 33);">token</font>`<font style="color:rgb(28, 30, 33);">ã€‚</font>

LCEL æ˜¯ä¸€ç§_å£°æ˜å¼_çš„æ–¹å¼ï¼Œé€šè¿‡å°†ä¸åŒçš„ LangChain åŸè¯­é“¾æ¥åœ¨ä¸€èµ·æ¥æŒ‡å®šä¸€ä¸ªâ€œç¨‹åºâ€ã€‚ä½¿ç”¨ LCEL åˆ›å»ºçš„é“¾å¯ä»¥è‡ªåŠ¨å®ç° `stream` å’Œ `astream`ï¼Œä»è€Œå®ç°å¯¹æœ€ç»ˆè¾“å‡ºçš„æµå¼ä¼ è¾“ã€‚äº‹å®ä¸Šï¼Œä½¿ç”¨ LCEL åˆ›å»ºçš„é“¾å®ç°äº†æ•´ä¸ªæ ‡å‡† Runnable æ¥å£ã€‚

```python
from langchain_core.output_parsers import StrOutputParser
from langchain_core.prompts import ChatPromptTemplate
prompt = ChatPromptTemplate.from_template("ç»™æˆ‘è®²ä¸€ä¸ªå…³äº{topic}çš„ç¬‘è¯")
parser = StrOutputParser()
chain = prompt | model | parser
async for chunk in chain.astream({"topic": "é¹¦é¹‰"}):
    print(chunk, end="|", flush=True)
    
```



```plain
|ä¸€ä¸ª|äºº|å»|å® |ç‰©|åº—|ä¹°|é¹¦|é¹‰|ã€‚|åº—|å‘˜|è¯´|ï¼šâ€œ|è¿™|åª|é¹¦|é¹‰|ä¼š|è¯´|è¯|ã€‚â€|
|ä¹°|å›|å®¶|å|ï¼Œ|é‚£|äºº|å‘|ç°|é¹¦|é¹‰|åª|ä¼š|è¯´|ä¸€|å¥|è¯|ï¼šâ€œ|æˆ‘|æ˜¯|é¹¦|é¹‰|ã€‚â€|
|é‚£|äºº|å°±|å»|æ‰¾|åº—|å‘˜|ï¼Œ|è¯´|ï¼šâ€œ|ä½ |ä¸|æ˜¯|è¯´|è¿™|åª|é¹¦|é¹‰|ä¼š|è¯´|è¯|å—|ï¼Ÿ|å®ƒ|åª|ä¼š|è¯´|â€˜|æˆ‘|æ˜¯|é¹¦|é¹‰|â€™|ã€‚â€|
|åº—|å‘˜|å›|ç­”|ï¼šâ€œ|å®ƒ|ç¡®|å®|ä¼š|è¯´|è¯|ï¼Œ|ä½ |æƒ³|å®ƒ|æ€|ä¹ˆ|å¯èƒ½|çŸ¥|é“|è‡ª|å·±|æ˜¯|é¹¦|é¹‰|å‘¢|ï¼Ÿâ€||
```



è¯·æ³¨æ„ï¼Œå³ä½¿æˆ‘ä»¬åœ¨ä¸Šé¢çš„é“¾æ¡æœ«å°¾ä½¿ç”¨äº†`parser`ï¼Œæˆ‘ä»¬ä»ç„¶å¯ä»¥è·å¾—æµå¼è¾“å‡ºã€‚`parser`ä¼šå¯¹æ¯ä¸ªæµå¼å—è¿›è¡Œæ“ä½œã€‚è®¸å¤šLCELåŸºå…ƒä¹Ÿæ”¯æŒè¿™ç§è½¬æ¢å¼çš„æµå¼ä¼ é€’ï¼Œè¿™åœ¨æ„å»ºåº”ç”¨ç¨‹åºæ—¶éå¸¸æ–¹ä¾¿ã€‚

è‡ªå®šä¹‰å‡½æ•°å¯ä»¥è¢«è®¾è®¡ä¸ºè¿”å›ç”Ÿæˆå™¨ï¼Œè¿™æ ·å°±èƒ½å¤Ÿæ“ä½œæµã€‚

æŸäº›å¯è¿è¡Œå®ä½“ï¼Œå¦‚æç¤ºæ¨¡æ¿å’ŒèŠå¤©æ¨¡å‹ï¼Œæ— æ³•å¤„ç†å•ä¸ªå—ï¼Œè€Œæ˜¯èšåˆæ‰€æœ‰å…ˆå‰çš„æ­¥éª¤ã€‚è¿™äº›å¯è¿è¡Œå®ä½“å¯ä»¥ä¸­æ–­æµå¤„ç†ã€‚

LangChainè¡¨è¾¾è¯­è¨€å…è®¸æ‚¨å°†é“¾çš„æ„å»ºä¸ä½¿ç”¨æ¨¡å¼ï¼ˆä¾‹å¦‚åŒæ­¥/å¼‚æ­¥ã€æ‰¹å¤„ç†/æµå¼ç­‰ï¼‰åˆ†å¼€ã€‚å¦‚æœè¿™ä¸æ‚¨æ„å»ºçš„å†…å®¹æ— å…³ï¼Œæ‚¨ä¹Ÿå¯ä»¥ä¾èµ–äºæ ‡å‡†çš„å‘½ä»¤å¼ç¼–ç¨‹æ–¹æ³•ï¼Œé€šè¿‡åœ¨æ¯ä¸ªç»„ä»¶ä¸Šè°ƒç”¨invokeã€batchæˆ–streamï¼Œå°†ç»“æœåˆ†é…ç»™å˜é‡ï¼Œç„¶åæ ¹æ®éœ€è¦åœ¨ä¸‹æ¸¸ä½¿ç”¨å®ƒä»¬ã€‚

**ä½¿ç”¨è¾“å…¥æµ**

å¦‚æœæ‚¨æƒ³è¦åœ¨è¾“å‡ºç”Ÿæˆæ—¶ä»ä¸­æµå¼ä¼ è¾“JSONï¼Œè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ

å¦‚æœæ‚¨ä¾èµ–`json.loads`æ¥è§£æéƒ¨åˆ†JSONï¼Œé‚£ä¹ˆè§£æå°†å¤±è´¥ï¼Œå› ä¸ºéƒ¨åˆ†JSONä¸ä¼šæ˜¯æœ‰æ•ˆçš„JSONã€‚

æ‚¨å¯èƒ½ä¼šæŸæ‰‹æ— ç­–ï¼Œå£°ç§°æ— æ³•æµå¼ä¼ è¾“JSONã€‚

äº‹å®è¯æ˜ï¼Œæœ‰ä¸€ç§æ–¹æ³•å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹â€”â€”è§£æå™¨éœ€è¦åœ¨**è¾“å…¥æµ**ä¸Šæ“ä½œï¼Œå¹¶å°è¯•å°†éƒ¨åˆ†JSONâ€œè‡ªåŠ¨å®Œæˆâ€ä¸ºæœ‰æ•ˆçŠ¶æ€ã€‚

è®©æˆ‘ä»¬çœ‹çœ‹è¿™æ ·ä¸€ä¸ªè§£æå™¨çš„è¿è¡Œï¼Œä»¥äº†è§£è¿™æ„å‘³ç€ä»€ä¹ˆã€‚

```python
model = ChatOpenAI(model="gpt-4")
parser = StrOutputParser()
chain = (
        model | JsonOutputParser()
    # ç”±äºLangchainæ—§ç‰ˆæœ¬ä¸­çš„ä¸€ä¸ªé”™è¯¯ï¼ŒJsonOutputParseræœªèƒ½ä»æŸäº›æ¨¡å‹ä¸­æµå¼ä¼ è¾“ç»“æœ
)
async def async_stream():
    async for text in chain.astream(
            "ä»¥JSON æ ¼å¼è¾“å‡ºæ³•å›½ã€è¥¿ç­ç‰™å’Œæ—¥æœ¬çš„å›½å®¶åŠå…¶äººå£åˆ—è¡¨ã€‚"
            'ä½¿ç”¨ä¸€ä¸ªå¸¦æœ‰â€œcountriesâ€å¤–éƒ¨é”®çš„å­—å…¸ï¼Œå…¶ä¸­åŒ…å«å›½å®¶åˆ—è¡¨ã€‚'
            "æ¯ä¸ªå›½å®¶éƒ½åº”è¯¥æœ‰é”®`name`å’Œ`population`"
    ):
        print(text, flush=True)
```



```json
{}
{'countries': []}
{'countries': [{}]}
{'countries': [{'name': ''}]}
{'countries': [{'name': 'France'}]}
{'countries': [{'name': 'France', 'population': 670}]}
{'countries': [{'name': 'France', 'population': 670810}]}
{'countries': [{'name': 'France', 'population': 67081000}]}
{'countries': [{'name': 'France', 'population': 67081000}, {}]}
{'countries': [{'name': 'France', 'population': 67081000}, {'name': ''}]}
{'countries': [{'name': 'France', 'population': 67081000}, {'name': 'Spain'}]}
{'countries': [{'name': 'France', 'population': 67081000}, {'name': 'Spain', 'population': 467}]}
{'countries': [{'name': 'France', 'population': 67081000}, {'name': 'Spain', 'population': 467330}]}
{'countries': [{'name': 'France', 'population': 67081000}, {'name': 'Spain', 'population': 46733038}]}
{'countries': [{'name': 'France', 'population': 67081000}, {'name': 'Spain', 'population': 46733038}, {}]}
{'countries': [{'name': 'France', 'population': 67081000}, {'name': 'Spain', 'population': 46733038}, {'name': ''}]}
{'countries': [{'name': 'France', 'population': 67081000}, {'name': 'Spain', 'population': 46733038}, {'name': 'Japan'}]}
{'countries': [{'name': 'France', 'population': 67081000}, {'name': 'Spain', 'population': 46733038}, {'name': 'Japan', 'population': 126}]}
{'countries': [{'name': 'France', 'population': 67081000}, {'name': 'Spain', 'population': 46733038}, {'name': 'Japan', 'population': 126300}]}
{'countries': [{'name': 'France', 'population': 67081000}, {'name': 'Spain', 'population': 46733038}, {'name': 'Japan', 'population': 126300000}]}
```





### <font style="color:rgb(28, 30, 33);">Stream events(äº‹ä»¶æµ)</font>
<font style="color:rgb(28, 30, 33);">ç°åœ¨æˆ‘ä»¬å·²ç»äº†è§£äº†</font>`<font style="color:rgb(28, 30, 33);">stream</font>`<font style="color:rgb(28, 30, 33);">å’Œ</font>`<font style="color:rgb(28, 30, 33);">astream</font>`<font style="color:rgb(28, 30, 33);">çš„å·¥ä½œåŸç†ï¼Œè®©æˆ‘ä»¬è¿›å…¥äº‹ä»¶æµçš„ä¸–ç•Œã€‚</font><font style="color:rgb(28, 30, 33);">ğŸï¸</font>

<font style="color:rgb(28, 30, 33);">äº‹ä»¶æµæ˜¯ä¸€ä¸ª</font>**<font style="color:rgb(28, 30, 33);">beta</font>**<font style="color:rgb(28, 30, 33);"> APIã€‚è¿™ä¸ªAPIå¯èƒ½ä¼šæ ¹æ®åé¦ˆç•¥å¾®æ›´æ”¹ã€‚</font>

æœ¬æŒ‡å—æ¼”ç¤ºäº†`V2` APIï¼Œå¹¶ä¸”éœ€è¦ langchain-core >= 0.2ã€‚å¯¹äºä¸æ—§ç‰ˆæœ¬ LangChain å…¼å®¹çš„`V1` APIï¼Œè¯·å‚é˜…[è¿™é‡Œ](https://python.langchain.com/v0.1/docs/expression_language/streaming/#using-stream-events)ã€‚

```python
import langchain_core
langchain_core.__version__
```

<font style="color:rgb(28, 30, 33);">ä¸ºäº†ä½¿</font>`<font style="color:rgb(28, 30, 33);">astream_events</font>`<font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">APIæ­£å¸¸å·¥ä½œï¼š</font>

+ <font style="color:rgb(28, 30, 33);">åœ¨ä»£ç ä¸­å°½å¯èƒ½ä½¿ç”¨</font>`<font style="color:rgb(28, 30, 33);">async</font>`<font style="color:rgb(28, 30, 33);">ï¼ˆä¾‹å¦‚ï¼Œå¼‚æ­¥å·¥å…·ç­‰ï¼‰</font>
+ <font style="color:rgb(28, 30, 33);">å¦‚æœå®šä¹‰è‡ªå®šä¹‰å‡½æ•°/å¯è¿è¡Œé¡¹ï¼Œè¯·ä¼ æ’­å›è°ƒ</font>
+ <font style="color:rgb(28, 30, 33);">åœ¨æ²¡æœ‰ LCEL çš„æƒ…å†µä¸‹ä½¿ç”¨å¯è¿è¡Œé¡¹æ—¶ï¼Œè¯·ç¡®ä¿åœ¨LLMsä¸Šè°ƒç”¨</font>`<font style="color:rgb(28, 30, 33);">.astream()</font>`<font style="color:rgb(28, 30, 33);">è€Œä¸æ˜¯</font>`<font style="color:rgb(28, 30, 33);">.ainvoke</font>`<font style="color:rgb(28, 30, 33);">ä»¥å¼ºåˆ¶LLMæµå¼ä¼ è¾“ä»¤ç‰Œ</font>

#### <font style="color:rgb(28, 30, 33);">äº‹ä»¶å‚è€ƒ</font>
<font style="color:rgb(28, 30, 33);">ä¸‹é¢æ˜¯ä¸€ä¸ªå‚è€ƒè¡¨ï¼Œæ˜¾ç¤ºå„ç§å¯è¿è¡Œå¯¹è±¡å¯èƒ½å‘å‡ºçš„ä¸€äº›äº‹ä»¶ã€‚</font>

å½“æµå¼ä¼ è¾“æ­£ç¡®å®ç°æ—¶ï¼Œå¯¹äºå¯è¿è¡Œé¡¹çš„è¾“å…¥ç›´åˆ°è¾“å…¥æµå®Œå…¨æ¶ˆè€—åæ‰ä¼šçŸ¥é“ã€‚è¿™æ„å‘³ç€`inputs`é€šå¸¸ä»…åŒ…æ‹¬`end`äº‹ä»¶ï¼Œè€Œä¸åŒ…æ‹¬`start`äº‹ä»¶ã€‚

| äº‹ä»¶ | åç§° | å— | è¾“å…¥ | è¾“å‡º |
| --- | --- | --- | --- | --- |
| on_chat_model_start | [æ¨¡å‹åç§°] | | {"messages": [[SystemMessage, HumanMessage]]} | |
| on_chat_model_end | [æ¨¡å‹åç§°] | | {"messages": [[SystemMessage, HumanMessage]]} | AIMessageChunk(content="hello world") |
| on_llm_start | [æ¨¡å‹åç§°] | | {'input': 'hello'} | |
| on_llm_stream | [æ¨¡å‹åç§°] | 'Hello' | | |
| on_llm_end | [æ¨¡å‹åç§°] | | 'Hello human!' | |
| on_chain_start | format_docs | | | |
| on_chain_stream | format_docs | "hello world!, goodbye world!" | | |
| on_chain_end | format_docs | | [Document(...)] | "hello world!, goodbye world!" |
| on_tool_start | some_tool | | {"x": 1, "y": "2"} | |
| on_tool_end | some_tool | | | {"x": 1, "y": "2"} |
| on_retriever_start | [æ£€ç´¢å™¨åç§°] | | {"query": "hello"} | |
| on_retriever_end | [æ£€ç´¢å™¨åç§°] | | {"query": "hello"} | [Document(...), ..] |
| on_prompt_start | [æ¨¡æ¿åç§°] | | {"question": "hello"} | |
| on_prompt_end | [æ¨¡æ¿åç§°] | | {"question": "hello"} | ChatPromptValue(messages: [SystemMessage, ...]) |


#### <font style="color:rgb(28, 30, 33);">èŠå¤©æ¨¡å‹</font>
<font style="color:rgb(28, 30, 33);">è®©æˆ‘ä»¬é¦–å…ˆçœ‹ä¸€ä¸‹èŠå¤©æ¨¡å‹äº§ç”Ÿçš„äº‹ä»¶ã€‚</font>

```python
events = []
async for event in model.astream_events("hello", version="v2"):
    events.append(event)
```

```plain
/home/eugene/src/langchain/libs/core/langchain_core/_api/beta_decorator.py:87: LangChainBetaWarning: This API is in beta and may change in the future.
  warn_beta(
```

å˜¿ï¼ŒAPIä¸­é‚£ä¸ªæœ‰è¶£çš„`version="v2"`å‚æ•°æ˜¯ä»€ä¹ˆæ„æ€ï¼ŸğŸ˜¾ è¿™æ˜¯ä¸€ä¸ª**beta API**ï¼Œæˆ‘ä»¬å‡ ä¹è‚¯å®šä¼šå¯¹å…¶è¿›è¡Œä¸€äº›æ›´æ”¹ï¼ˆäº‹å®ä¸Šï¼Œæˆ‘ä»¬å·²ç»åšäº†ï¼ï¼‰ è¿™ä¸ªç‰ˆæœ¬å‚æ•°å°†å…è®¸æˆ‘ä»¬æœ€å°åŒ–å¯¹æ‚¨ä»£ç çš„ç ´åæ€§æ›´æ”¹ã€‚ ç®€è€Œè¨€ä¹‹ï¼Œæˆ‘ä»¬ç°åœ¨è®©æ‚¨æ„Ÿåˆ°çƒ¦æ¼ï¼Œè¿™æ ·ä»¥åå°±ä¸å¿…å†çƒ¦æ¼äº†ã€‚ `v2`ä»…é€‚ç”¨äº langchain-core>=0.2.0ã€‚

<font style="color:rgb(28, 30, 33);">è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ä¸€äº›å¼€å§‹äº‹ä»¶å’Œä¸€äº›ç»“æŸäº‹ä»¶ã€‚</font>

```python
events[:3]
```

```json
[{'event': 'on_chat_model_start',
  'data': {'input': 'hello'},
  'name': 'ChatAnthropic',
  'tags': [],
  'run_id': 'a81e4c0f-fc36-4d33-93bc-1ac25b9bb2c3',
  'metadata': {}},
 {'event': 'on_chat_model_stream',
  'data': {'chunk': AIMessageChunk(content='Hello', id='run-a81e4c0f-fc36-4d33-93bc-1ac25b9bb2c3')},
  'run_id': 'a81e4c0f-fc36-4d33-93bc-1ac25b9bb2c3',
  'name': 'ChatAnthropic',
  'tags': [],
  'metadata': {}},
 {'event': 'on_chat_model_stream',
  'data': {'chunk': AIMessageChunk(content='!', id='run-a81e4c0f-fc36-4d33-93bc-1ac25b9bb2c3')},
  'run_id': 'a81e4c0f-fc36-4d33-93bc-1ac25b9bb2c3',
  'name': 'ChatAnthropic',
  'tags': [],
  'metadata': {}}]
```

```python
events[-2:]
```

```json
[{'event': 'on_chat_model_stream',
  'data': {'chunk': AIMessageChunk(content='?', id='run-a81e4c0f-fc36-4d33-93bc-1ac25b9bb2c3')},
  'run_id': 'a81e4c0f-fc36-4d33-93bc-1ac25b9bb2c3',
  'name': 'ChatAnthropic',
  'tags': [],
  'metadata': {}},
  {'event': 'on_chat_model_end',
  'data': {'output': AIMessageChunk(content='Hello! How can I assist you today?', id='run-a81e4c0f-fc36-4d33-93bc-1ac25b9bb2c3')},
  'run_id': 'a81e4c0f-fc36-4d33-93bc-1ac25b9bb2c3',
  'name': 'ChatAnthropic',
  'tags': [],
  'metadata': {}}]
```

## LLM apps debug: LangSmith Tracing & Verbose, Debug Mode 
<font style="color:rgb(28, 30, 33);">ä¸æ„å»ºä»»ä½•ç±»å‹çš„è½¯ä»¶ä¸€æ ·ï¼Œä½¿ç”¨LLMæ„å»ºæ—¶ï¼Œæ€»ä¼šæœ‰è°ƒè¯•çš„éœ€æ±‚ã€‚æ¨¡å‹è°ƒç”¨å¯èƒ½ä¼šå¤±è´¥ï¼Œæ¨¡å‹è¾“å‡ºå¯èƒ½æ ¼å¼é”™è¯¯ï¼Œæˆ–è€…å¯èƒ½å­˜åœ¨ä¸€äº›åµŒå¥—çš„æ¨¡å‹è°ƒç”¨ï¼Œä¸æ¸…æ¥šåœ¨å“ªä¸€æ­¥å‡ºç°äº†é”™è¯¯çš„è¾“å‡ºã€‚ æœ‰ä¸‰ç§ä¸»è¦çš„è°ƒè¯•æ–¹æ³•ï¼š</font>

+ <font style="color:rgb(28, 30, 33);">è¯¦ç»†æ¨¡å¼(Verbose)ï¼šä¸ºä½ çš„é“¾ä¸­çš„â€œé‡è¦â€äº‹ä»¶æ·»åŠ æ‰“å°è¯­å¥ã€‚</font>
+ <font style="color:rgb(28, 30, 33);">è°ƒè¯•æ¨¡å¼(Debug)ï¼šä¸ºä½ çš„é“¾ä¸­çš„æ‰€æœ‰äº‹ä»¶æ·»åŠ æ—¥å¿—è®°å½•è¯­å¥ã€‚</font>
+ <font style="color:rgb(28, 30, 33);">LangSmithè·Ÿè¸ªï¼šå°†äº‹ä»¶è®°å½•åˆ°</font>[<font style="color:rgb(28, 30, 33);">LangSmith</font>](https://docs.smith.langchain.com/)<font style="color:rgb(28, 30, 33);">ï¼Œä»¥ä¾¿åœ¨é‚£é‡Œè¿›è¡Œå¯è§†åŒ–ã€‚</font>

|  | <font style="color:rgb(28, 30, 33);">è¯¦ç»†æ¨¡å¼(Verbose Mode)</font> | <font style="color:rgb(28, 30, 33);">è°ƒè¯•æ¨¡å¼(Debug Mode)</font> | <font style="color:rgb(28, 30, 33);">LangSmithè·Ÿè¸ª</font> |
| --- | --- | --- | --- |
| <font style="color:rgb(28, 30, 33);">å…è´¹</font> | âœ… | âœ… | âœ… |
| <font style="color:rgb(28, 30, 33);">ç”¨æˆ·ç•Œé¢</font> | âŒ | âŒ | âœ… |
| <font style="color:rgb(28, 30, 33);">æŒä¹…åŒ–</font> | âŒ | âŒ | âœ… |
| <font style="color:rgb(28, 30, 33);">æŸ¥çœ‹æ‰€æœ‰äº‹ä»¶</font> | âŒ | âœ… | âœ… |
| <font style="color:rgb(28, 30, 33);">æŸ¥çœ‹â€œé‡è¦â€äº‹ä»¶</font> | âœ… | âŒ | âœ… |
| <font style="color:rgb(28, 30, 33);">æœ¬åœ°è¿è¡Œ</font> | âœ… | âœ… | âŒ |


### LangSmith Tracing(è·Ÿè¸ª)
<font style="color:rgb(28, 30, 33);">ä½¿ç”¨LangChainæ„å»ºçš„è®¸å¤šåº”ç”¨ç¨‹åºå°†åŒ…å«å¤šä¸ªæ­¥éª¤ï¼Œå…¶ä¸­åŒ…å«å¤šæ¬¡LLMè°ƒç”¨ã€‚ éšç€è¿™äº›åº”ç”¨ç¨‹åºå˜å¾—è¶Šæ¥è¶Šå¤æ‚ï¼Œèƒ½å¤Ÿæ£€æŸ¥é“¾æˆ–ä»£ç†å†…éƒ¨å‘ç”Ÿäº†ä»€ä¹ˆå˜å¾—è‡³å…³é‡è¦ã€‚ è¿™æ ·åšçš„æœ€ä½³æ–¹å¼æ˜¯ä½¿ç”¨</font>[<font style="color:rgb(28, 30, 33);">LangSmith</font>](https://smith.langchain.com/)<font style="color:rgb(28, 30, 33);">ã€‚ åœ¨ä¸Šé¢çš„é“¾æ¥ä¸Šæ³¨å†Œåï¼Œè¯·ç¡®ä¿è®¾ç½®ä½ çš„ç¯å¢ƒå˜é‡ä»¥å¼€å§‹è®°å½•è·Ÿè¸ªï¼š</font>

```powershell
#windowså¯¼å…¥ç¯å¢ƒå˜é‡
setx LANGCHAIN_TRACING_V2 "true"
setx LANGCHAIN_API_KEY "..."
setx TAVILY_API_KEY "..."

#mac å¯¼å…¥ç¯å¢ƒå˜é‡
export LANGCHAIN_TRACING_V2="true"
export LANGCHAIN_API_KEY="..."
export TAVILY_API_KEY="..."
```

<font style="color:rgb(28, 30, 33);">å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªä»£ç†ï¼Œå¹¶ä¸”å¸Œæœ›å¯è§†åŒ–å®ƒæ‰€é‡‡å–çš„æ“ä½œå’Œæ¥æ”¶åˆ°çš„å·¥å…·è¾“å‡ºã€‚åœ¨æ²¡æœ‰ä»»ä½•è°ƒè¯•çš„æƒ…å†µä¸‹ï¼Œè¿™æ˜¯æˆ‘ä»¬çœ‹åˆ°çš„ï¼š</font>

```python
import os
from langchain_openai import ChatOpenAI
from langchain.agents import AgentExecutor, create_tool_calling_agent
from langchain_community.tools.tavily_search import TavilySearchResults
from langchain_core.prompts import ChatPromptTemplate
from langchain.globals import set_verbose

llm = ChatOpenAI(model="gpt-4o")
tools = [TavilySearchResults(max_results=1)]
prompt = ChatPromptTemplate.from_messages(
    [
        (
            "system",
            "ä½ æ˜¯ä¸€ä½å¾—åŠ›çš„åŠ©æ‰‹ã€‚",
        ),
        ("placeholder", "{chat_history}"),
        ("human", "{input}"),
        ("placeholder", "{agent_scratchpad}"),
    ]
)
# æ„å»ºå·¥å…·ä»£ç†
agent = create_tool_calling_agent(llm, tools, prompt)
set_verbose(True)
# é€šè¿‡ä¼ å…¥ä»£ç†å’Œå·¥å…·æ¥åˆ›å»ºä»£ç†æ‰§è¡Œå™¨
agent_executor = AgentExecutor(agent=agent, tools=tools)
agent_executor.invoke(
    {"input": "è°æ‰§å¯¼äº†2023å¹´çš„ç”µå½±ã€Šå¥¥æœ¬æµ·é»˜ã€‹ï¼Œä»–å¤šå°‘å²äº†ï¼Ÿ"}
)
```

```json
{'input': 'è°æ‰§å¯¼äº†2023å¹´çš„ç”µå½±ã€Šå¥¥æœ¬æµ·é»˜ã€‹ï¼Œä»–å¤šå°‘å²äº†ï¼Ÿ', 'output': 'å…‹é‡Œæ–¯æ‰˜å¼—Â·è¯ºå…°ï¼ˆChristopher Nolanï¼‰å‡ºç”Ÿäº1970å¹´7æœˆ30æ—¥ã€‚æˆªè‡³2023å¹´ï¼Œä»–53å²ã€‚'}
```

<font style="color:rgb(28, 30, 33);">æˆ‘ä»¬æ²¡æœ‰å¾—åˆ°å¤ªå¤šè¾“å‡ºï¼Œä½†ç”±äºæˆ‘ä»¬è®¾ç½®äº†LangSmithï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾åœ°çœ‹åˆ°å‘ç”Ÿäº†ä»€ä¹ˆï¼š </font>[https://smith.langchain.com/public/a89ff88f-9ddc-4757-a395-3a1b365655bf/r](https://smith.langchain.com/public/a89ff88f-9ddc-4757-a395-3a1b365655bf/r)

### <font style="color:rgb(28, 30, 33);">Verbose(è¯¦ç»†æ—¥å¿—æ‰“å°)</font>
<font style="color:rgb(28, 30, 33);">å¦‚æœä½ åœ¨Jupyterç¬”è®°æœ¬ä¸­è¿›è¡ŒåŸå‹è®¾è®¡æˆ–è¿è¡ŒPythonè„šæœ¬ï¼Œæ‰“å°å‡ºé“¾è¿è¡Œçš„ä¸­é—´æ­¥éª¤å¯èƒ½ä¼šæœ‰æ‰€å¸®åŠ©ã€‚ æœ‰è®¸å¤šæ–¹æ³•å¯ä»¥ä»¥ä¸åŒç¨‹åº¦çš„è¯¦ç»†ç¨‹åº¦å¯ç”¨æ‰“å°ã€‚ æ³¨æ„ï¼šå³ä½¿å¯ç”¨äº†LangSmithï¼Œè¿™äº›ä»ç„¶æœ‰æ•ˆï¼Œå› æ­¤ä½ å¯ä»¥åŒæ—¶æ‰“å¼€å¹¶è¿è¡Œå®ƒä»¬ã€‚</font>

`set_verbose(True)`

<font style="color:rgb(28, 30, 33);">è®¾ç½®</font><font style="color:rgb(28, 30, 33);"> </font>`<font style="color:rgb(28, 30, 33);">verbose</font>`<font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">æ ‡å¿—å°†ä»¥ç¨å¾®æ›´æ˜“è¯»çš„æ ¼å¼æ‰“å°å‡ºè¾“å…¥å’Œè¾“å‡ºï¼Œå¹¶å°†è·³è¿‡è®°å½•æŸäº›åŸå§‹è¾“å‡ºï¼ˆä¾‹å¦‚ LLM è°ƒç”¨çš„ä»¤ç‰Œä½¿ç”¨ç»Ÿè®¡ä¿¡æ¯ï¼‰ï¼Œä»¥ä¾¿æ‚¨å¯ä»¥ä¸“æ³¨äºåº”ç”¨ç¨‹åºé€»è¾‘ã€‚</font>

```python
from langchain.globals import set_verbose
set_verbose(True)
agent_executor = AgentExecutor(agent=agent, tools=tools)
agent_executor.invoke(
    {"input": "Who directed the 2023 film Oppenheimer and what is their age in days?"}
)
```

```powershell
> Entering new AgentExecutor chain...

Invoking: `tavily_search_results_json` with `{'query': '2023 movie Oppenheimer director'}`


[{'url': 'https://www.imdb.com/title/tt15398776/fullcredits/', 'content': 'Oppenheimer (2023) cast and crew credits, including actors, actresses, directors, writers and more. Menu. ... director of photography: behind-the-scenes Jason Gary ... best boy grip ... film loader Luc Poullain ... aerial coordinator'}]
Invoking: `tavily_search_results_json` with `{'query': 'Christopher Nolan age'}`


[{'url': 'https://www.nme.com/news/film/christopher-nolan-fans-are-celebrating-his-54th-birthday-youve-changed-things-forever-3779396', 'content': "Christopher Nolan is 54 Still my fave bit of Nolan trivia: Joey Pantoliano on creating Ralph Cifaretto's look in The Sopranos: 'The wig I had them build as an homage to Chris Nolan, I like ..."}]2023å¹´çš„ç”µå½±ã€Šå¥¥æœ¬æµ·é»˜ã€‹ç”±å…‹é‡Œæ–¯æ‰˜å¼—Â·è¯ºå…°ï¼ˆChristopher Nolanï¼‰æ‰§å¯¼ã€‚ä»–ç›®å‰54å²ã€‚

> Finished chain.
```

```json
{'input': 'è°æ‰§å¯¼äº†2023å¹´çš„ç”µå½±ã€Šå¥¥æœ¬æµ·é»˜ã€‹ï¼Œä»–å¤šå°‘å²äº†ï¼Ÿ', 'output': 'å…‹é‡Œæ–¯æ‰˜å¼—Â·è¯ºå…°ï¼ˆChristopher Nolanï¼‰å‡ºç”Ÿäº1970å¹´7æœˆ30æ—¥ã€‚æˆªè‡³2023å¹´ï¼Œä»–53å²ã€‚'}
```



### <font style="color:rgb(28, 30, 33);">Debug(è°ƒè¯•æ—¥å¿—æ‰“å°)</font>
`set_debug(True)`

<font style="color:rgb(28, 30, 33);">è®¾ç½®å…¨å±€çš„</font><font style="color:rgb(28, 30, 33);"> </font>`<font style="color:rgb(28, 30, 33);">debug</font>`<font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">æ ‡å¿—å°†å¯¼è‡´æ‰€æœ‰å…·æœ‰å›è°ƒæ”¯æŒçš„ LangChain ç»„ä»¶ï¼ˆé“¾ã€æ¨¡å‹ã€ä»£ç†ã€å·¥å…·ã€æ£€ç´¢å™¨ï¼‰æ‰“å°å®ƒä»¬æ¥æ”¶çš„è¾“å…¥å’Œç”Ÿæˆçš„è¾“å‡ºã€‚è¿™æ˜¯æœ€è¯¦ç»†çš„è®¾ç½®ï¼Œå°†å®Œå…¨è®°å½•åŸå§‹è¾“å…¥å’Œè¾“å‡ºã€‚</font>

```python
from langchain.globals import set_debug
# æ„å»ºå·¥å…·ä»£ç†
agent = create_tool_calling_agent(llm, tools, prompt)
#æ‰“å°è°ƒè¯•æ—¥å¿—
set_debug(True)
#ä¸è¾“å‡ºè¯¦ç»†æ—¥å¿—
set_verbose(False)
# é€šè¿‡ä¼ å…¥ä»£ç†å’Œå·¥å…·æ¥åˆ›å»ºä»£ç†æ‰§è¡Œå™¨
agent_executor = AgentExecutor(agent=agent, tools=tools)
agent_executor.invoke(
    {"input": "è°æ‰§å¯¼äº†2023å¹´çš„ç”µå½±ã€Šå¥¥æœ¬æµ·é»˜ã€‹ï¼Œä»–å¤šå°‘å²äº†ï¼Ÿ"}
)
```

```powershell
[chain/start] [chain:AgentExecutor] Entering Chain run with input:
{
  "input": "è°æ‰§å¯¼äº†2023å¹´çš„ç”µå½±ã€Šå¥¥æœ¬æµ·é»˜ã€‹ï¼Œä»–å¤šå°‘å²äº†ï¼Ÿ"
}
[chain/start] [chain:AgentExecutor > chain:RunnableSequence] Entering Chain run with input:
{
  "input": ""
}
[chain/start] [chain:AgentExecutor > chain:RunnableSequence > chain:RunnableAssign<agent_scratchpad>] Entering Chain run with input:
{
  "input": ""
}
[chain/start] [chain:AgentExecutor > chain:RunnableSequence > chain:RunnableAssign<agent_scratchpad> > chain:RunnableParallel<agent_scratchpad>] Entering Chain run with input:
{
  "input": ""
}
[chain/start] [chain:AgentExecutor > chain:RunnableSequence > chain:RunnableAssign<agent_scratchpad> > chain:RunnableParallel<agent_scratchpad> > chain:RunnableLambda] Entering Chain run with input:
{
  "input": ""
}
[chain/end] [chain:AgentExecutor > chain:RunnableSequence > chain:RunnableAssign<agent_scratchpad> > chain:RunnableParallel<agent_scratchpad> > chain:RunnableLambda] [1ms] Exiting Chain run with output:
{
  "output": []
}
[chain/end] [chain:AgentExecutor > chain:RunnableSequence > chain:RunnableAssign<agent_scratchpad> > chain:RunnableParallel<agent_scratchpad>] [4ms] Exiting Chain run with output:
{
  "agent_scratchpad": []
}
[chain/end] [chain:AgentExecutor > chain:RunnableSequence > chain:RunnableAssign<agent_scratchpad>] [10ms] Exiting Chain run with output:
{
  "input": "è°æ‰§å¯¼äº†2023å¹´çš„ç”µå½±ã€Šå¥¥æœ¬æµ·é»˜ã€‹ï¼Œä»–å¤šå°‘å²äº†ï¼Ÿ",
  "intermediate_steps": [],
  "agent_scratchpad": []
}
[chain/start] [chain:AgentExecutor > chain:RunnableSequence > prompt:ChatPromptTemplate] Entering Prompt run with input:
{
  "input": "è°æ‰§å¯¼äº†2023å¹´çš„ç”µå½±ã€Šå¥¥æœ¬æµ·é»˜ã€‹ï¼Œä»–å¤šå°‘å²äº†ï¼Ÿ",
  "intermediate_steps": [],
  "agent_scratchpad": []
}
[chain/end] [chain:AgentExecutor > chain:RunnableSequence > prompt:ChatPromptTemplate] [1ms] Exiting Prompt run with output:
[outputs]
[llm/start] [chain:AgentExecutor > chain:RunnableSequence > llm:ChatOpenAI] Entering LLM run with input:
{
  "prompts": [
    "System: ä½ æ˜¯ä¸€ä½å¾—åŠ›çš„åŠ©æ‰‹ã€‚\nHuman: è°æ‰§å¯¼äº†2023å¹´çš„ç”µå½±ã€Šå¥¥æœ¬æµ·é»˜ã€‹ï¼Œä»–å¤šå°‘å²äº†ï¼Ÿ"
  ]
}
[llm/end] [chain:AgentExecutor > chain:RunnableSequence > llm:ChatOpenAI] [1.81s] Exiting LLM run with output:
{
  "generations": [
    [
      {
        "text": "",
        "generation_info": {
          "finish_reason": "tool_calls",
          "model_name": "gpt-4o-2024-05-13",
          "system_fingerprint": "fp_4e2b2da518"
        },
        "type": "ChatGenerationChunk",
        "message": {
          "lc": 1,
          "type": "constructor",
          "id": [
            "langchain",
            "schema",
            "messages",
            "AIMessageChunk"
          ],
          "kwargs": {
            "content": "",
            "additional_kwargs": {
              "tool_calls": [
                {
                  "index": 0,
                  "id": "call_Rhv2KLzFTU0XhJso5F79EiUp",
                  "function": {
                    "arguments": "{\"query\":\"2023å¹´ç”µå½±ã€Šå¥¥æœ¬æµ·é»˜ã€‹å¯¼æ¼”\"}",
                    "name": "tavily_search_results_json"
                  },
                  "type": "function"
                }
              ]
            },
            "response_metadata": {
              "finish_reason": "tool_calls",
              "model_name": "gpt-4o-2024-05-13",
              "system_fingerprint": "fp_4e2b2da518"
            },
            "type": "AIMessageChunk",
            "id": "run-cbeb35e8-b4ee-4c78-b663-e338ef90382d",
            "tool_calls": [
              {
                "name": "tavily_search_results_json",
                "args": {
                  "query": "2023å¹´ç”µå½±ã€Šå¥¥æœ¬æµ·é»˜ã€‹å¯¼æ¼”"
                },
                "id": "call_Rhv2KLzFTU0XhJso5F79EiUp",
                "type": "tool_call"
              }
            ],
            "tool_call_chunks": [
              {
                "name": "tavily_search_results_json",
                "args": "{\"query\":\"2023å¹´ç”µå½±ã€Šå¥¥æœ¬æµ·é»˜ã€‹å¯¼æ¼”\"}",
                "id": "call_Rhv2KLzFTU0XhJso5F79EiUp",
                "index": 0,
                "type": "tool_call_chunk"
              }
            ],
            "invalid_tool_calls": []
          }
        }
      }
    ]
  ],
  "llm_output": null,
  "run": null
}
[chain/start] [chain:AgentExecutor > chain:RunnableSequence > parser:ToolsAgentOutputParser] Entering Parser run with input:
[inputs]
[chain/end] [chain:AgentExecutor > chain:RunnableSequence > parser:ToolsAgentOutputParser] [2ms] Exiting Parser run with output:
[outputs]
[chain/end] [chain:AgentExecutor > chain:RunnableSequence] [1.85s] Exiting Chain run with output:
[outputs]
[tool/start] [chain:AgentExecutor > tool:tavily_search_results_json] Entering Tool run with input:
"{'query': '2023å¹´ç”µå½±ã€Šå¥¥æœ¬æµ·é»˜ã€‹å¯¼æ¼”'}"
[tool/end] [chain:AgentExecutor > tool:tavily_search_results_json] [2.06s] Exiting Tool run with output:
"[{'url': 'https://baike.baidu.com/item/å¥¥æœ¬æµ·é»˜/58802734', 'content': 'ã€Šå¥¥æœ¬æµ·é»˜ã€‹æ˜¯å…‹é‡Œæ–¯æ‰˜å¼—Â·è¯ºå…°è‡ªç¼–è‡ªå¯¼çš„ï¼Œç”±åŸºé‡Œå®‰Â·å¢¨è²ä¸»æ¼”çš„ä¼ è®°ç”µå½±ï¼Œè¯¥ç‰‡äº2023å¹´7æœˆ21æ—¥åœ¨åŒ—ç¾ä¸Šæ˜ ï¼Œ8æœˆ30æ—¥åœ¨ä¸­å›½å†…åœ°ä¸Šæ˜ ï¼Œ2024å¹´3æœˆ29æ—¥åœ¨æ—¥æœ¬ä¸Šæ˜ ã€‚è¯¥ç‰‡æ”¹ç¼–è‡ªKai Birdã€Martin J. Sherwinçš„ã€Šç¾å›½æ™®ç½—ç±³ä¿®æ–¯ï¼šå¥¥æœ¬æµ·é»˜çš„èƒœä¸æ‚²ã€‹ï¼Œå½±ç‰‡ã€Šå¥¥æœ¬æµ·é»˜ã€‹è®²è¿°äº†ç¾å›½"åŸå­å¼¹ä¹‹çˆ¶"ç½—ä¼¯ç‰¹Â· ...'}]"
[chain/start] [chain:AgentExecutor > chain:RunnableSequence] Entering Chain run with input:
{
  "input": ""
}
[chain/start] [chain:AgentExecutor > chain:RunnableSequence > chain:RunnableAssign<agent_scratchpad>] Entering Chain run with input:
{
  "input": ""
}
[chain/start] [chain:AgentExecutor > chain:RunnableSequence > chain:RunnableAssign<agent_scratchpad> > chain:RunnableParallel<agent_scratchpad>] Entering Chain run with input:
{
  "input": ""
}
[chain/start] [chain:AgentExecutor > chain:RunnableSequence > chain:RunnableAssign<agent_scratchpad> > chain:RunnableParallel<agent_scratchpad> > chain:RunnableLambda] Entering Chain run with input:
{
  "input": ""
}
[chain/end] [chain:AgentExecutor > chain:RunnableSequence > chain:RunnableAssign<agent_scratchpad> > chain:RunnableParallel<agent_scratchpad> > chain:RunnableLambda] [1ms] Exiting Chain run with output:
[outputs]
[chain/end] [chain:AgentExecutor > chain:RunnableSequence > chain:RunnableAssign<agent_scratchpad> > chain:RunnableParallel<agent_scratchpad>] [4ms] Exiting Chain run with output:
[outputs]
[chain/end] [chain:AgentExecutor > chain:RunnableSequence > chain:RunnableAssign<agent_scratchpad>] [10ms] Exiting Chain run with output:
[outputs]
[chain/start] [chain:AgentExecutor > chain:RunnableSequence > prompt:ChatPromptTemplate] Entering Prompt run with input:
[inputs]
[chain/end] [chain:AgentExecutor > chain:RunnableSequence > prompt:ChatPromptTemplate] [1ms] Exiting Prompt run with output:
[outputs]
[llm/start] [chain:AgentExecutor > chain:RunnableSequence > llm:ChatOpenAI] Entering LLM run with input:
{
  "prompts": [
    "System: ä½ æ˜¯ä¸€ä½å¾—åŠ›çš„åŠ©æ‰‹ã€‚\nHuman: è°æ‰§å¯¼äº†2023å¹´çš„ç”µå½±ã€Šå¥¥æœ¬æµ·é»˜ã€‹ï¼Œä»–å¤šå°‘å²äº†ï¼Ÿ\nAI: \nTool: [{\"url\": \"https://baike.baidu.com/item/å¥¥æœ¬æµ·é»˜/58802734\", \"content\": \"ã€Šå¥¥æœ¬æµ·é»˜ã€‹æ˜¯å…‹é‡Œæ–¯æ‰˜å¼—Â·è¯ºå…°è‡ªç¼–è‡ªå¯¼çš„ï¼Œç”±åŸºé‡Œå®‰Â·å¢¨è²ä¸»æ¼”çš„ä¼ è®°ç”µå½±ï¼Œè¯¥ç‰‡äº2023å¹´7æœˆ21æ—¥åœ¨åŒ—ç¾ä¸Šæ˜ ï¼Œ8æœˆ30æ—¥åœ¨ä¸­å›½å†…åœ°ä¸Šæ˜ ï¼Œ2024å¹´3æœˆ29æ—¥åœ¨æ—¥æœ¬ä¸Šæ˜ ã€‚è¯¥ç‰‡æ”¹ç¼–è‡ªKai Birdã€Martin J. Sherwinçš„ã€Šç¾å›½æ™®ç½—ç±³ä¿®æ–¯ï¼šå¥¥æœ¬æµ·é»˜çš„èƒœä¸æ‚²ã€‹ï¼Œå½±ç‰‡ã€Šå¥¥æœ¬æµ·é»˜ã€‹è®²è¿°äº†ç¾å›½\\\"åŸå­å¼¹ä¹‹çˆ¶\\\"ç½—ä¼¯ç‰¹Â· ...\"}]"
  ]
}
[llm/end] [chain:AgentExecutor > chain:RunnableSequence > llm:ChatOpenAI] [1.39s] Exiting LLM run with output:
{
  "generations": [
    [
      {
        "text": "2023å¹´ç”µå½±ã€Šå¥¥æœ¬æµ·é»˜ã€‹çš„å¯¼æ¼”æ˜¯å…‹é‡Œæ–¯æ‰˜å¼—Â·è¯ºå…°ã€‚æ¥ä¸‹æ¥æˆ‘å°†æŸ¥è¯¢ä»–çš„å¹´é¾„ã€‚",
        "generation_info": {
          "finish_reason": "tool_calls",
          "model_name": "gpt-4o-2024-05-13",
          "system_fingerprint": "fp_4e2b2da518"
        },
        "type": "ChatGenerationChunk",
        "message": {
          "lc": 1,
          "type": "constructor",
          "id": [
            "langchain",
            "schema",
            "messages",
            "AIMessageChunk"
          ],
          "kwargs": {
            "content": "2023å¹´ç”µå½±ã€Šå¥¥æœ¬æµ·é»˜ã€‹çš„å¯¼æ¼”æ˜¯å…‹é‡Œæ–¯æ‰˜å¼—Â·è¯ºå…°ã€‚æ¥ä¸‹æ¥æˆ‘å°†æŸ¥è¯¢ä»–çš„å¹´é¾„ã€‚",
            "additional_kwargs": {
              "tool_calls": [
                {
                  "index": 0,
                  "id": "call_QuKQUKd6YLsgTgZeYcWpk2lN",
                  "function": {
                    "arguments": "{\"query\":\"å…‹é‡Œæ–¯æ‰˜å¼—Â·è¯ºå…°å¹´é¾„\"}",
                    "name": "tavily_search_results_json"
                  },
                  "type": "function"
                }
              ]
            },
            "response_metadata": {
              "finish_reason": "tool_calls",
              "model_name": "gpt-4o-2024-05-13",
              "system_fingerprint": "fp_4e2b2da518"
            },
            "type": "AIMessageChunk",
            "id": "run-b7ee6125-1af5-4073-b81e-076a859755bd",
            "tool_calls": [
              {
                "name": "tavily_search_results_json",
                "args": {
                  "query": "å…‹é‡Œæ–¯æ‰˜å¼—Â·è¯ºå…°å¹´é¾„"
                },
                "id": "call_QuKQUKd6YLsgTgZeYcWpk2lN",
                "type": "tool_call"
              }
            ],
            "tool_call_chunks": [
              {
                "name": "tavily_search_results_json",
                "args": "{\"query\":\"å…‹é‡Œæ–¯æ‰˜å¼—Â·è¯ºå…°å¹´é¾„\"}",
                "id": "call_QuKQUKd6YLsgTgZeYcWpk2lN",
                "index": 0,
                "type": "tool_call_chunk"
              }
            ],
            "invalid_tool_calls": []
          }
        }
      }
    ]
  ],
  "llm_output": null,
  "run": null
}
[chain/start] [chain:AgentExecutor > chain:RunnableSequence > parser:ToolsAgentOutputParser] Entering Parser run with input:
[inputs]
[chain/end] [chain:AgentExecutor > chain:RunnableSequence > parser:ToolsAgentOutputParser] [1ms] Exiting Parser run with output:
[outputs]
[chain/end] [chain:AgentExecutor > chain:RunnableSequence] [1.43s] Exiting Chain run with output:
[outputs]
[tool/start] [chain:AgentExecutor > tool:tavily_search_results_json] Entering Tool run with input:
"{'query': 'å…‹é‡Œæ–¯æ‰˜å¼—Â·è¯ºå…°å¹´é¾„'}"
[tool/end] [chain:AgentExecutor > tool:tavily_search_results_json] [2.89s] Exiting Tool run with output:
"[{'url': 'https://baike.baidu.com/item/å…‹é‡Œæ–¯æ‰˜å¼—Â·è¯ºå…°/5306405', 'content': 'å…‹é‡Œæ–¯æ‰˜å¼—Â·è¯ºå…°ï¼ˆChristopher Nolanï¼‰ï¼Œ1970å¹´7æœˆ30æ—¥å‡ºç”Ÿäºè‹±å›½ä¼¦æ•¦ï¼Œå¯¼æ¼”ã€ç¼–å‰§ã€åˆ¶ç‰‡äººã€‚1998å¹´4æœˆ24æ—¥å…‹é‡Œæ–¯æ‰˜å¼—Â·è¯ºå…°æ‹æ‘„çš„é¦–éƒ¨æ•…äº‹ç‰‡ã€Šè¿½éšã€‹åœ¨æ—§é‡‘å±±ç”µå½±èŠ‚ä¸Šæ˜ ã€‚2000å¹´ï¼Œå…‹é‡Œæ–¯æ‰˜å¼—Â·è¯ºå…°å‡­å€Ÿç€ä»–çš„ã€Šè®°å¿†ç¢ç‰‡ã€‹ä¸ºä»–è·å¾—ç¬¬74å±Šå¥¥æ–¯å¡çš„æåã€‚2005å¹´ï¼Œæ‰§å¯¼ã€Šè™è ä¾ ã€‹ä¸‰éƒ¨æ›²ç³»åˆ—é¦–éƒ¨ç”µå½± ...'}]"
[chain/start] [chain:AgentExecutor > chain:RunnableSequence] Entering Chain run with input:
{
  "input": ""
}
[chain/start] [chain:AgentExecutor > chain:RunnableSequence > chain:RunnableAssign<agent_scratchpad>] Entering Chain run with input:
{
  "input": ""
}
[chain/start] [chain:AgentExecutor > chain:RunnableSequence > chain:RunnableAssign<agent_scratchpad> > chain:RunnableParallel<agent_scratchpad>] Entering Chain run with input:
{
  "input": ""
}
[chain/start] [chain:AgentExecutor > chain:RunnableSequence > chain:RunnableAssign<agent_scratchpad> > chain:RunnableParallel<agent_scratchpad> > chain:RunnableLambda] Entering Chain run with input:
{
  "input": ""
}
[chain/end] [chain:AgentExecutor > chain:RunnableSequence > chain:RunnableAssign<agent_scratchpad> > chain:RunnableParallel<agent_scratchpad> > chain:RunnableLambda] [1ms] Exiting Chain run with output:
[outputs]
[chain/end] [chain:AgentExecutor > chain:RunnableSequence > chain:RunnableAssign<agent_scratchpad> > chain:RunnableParallel<agent_scratchpad>] [4ms] Exiting Chain run with output:
[outputs]
[chain/end] [chain:AgentExecutor > chain:RunnableSequence > chain:RunnableAssign<agent_scratchpad>] [9ms] Exiting Chain run with output:
[outputs]
[chain/start] [chain:AgentExecutor > chain:RunnableSequence > prompt:ChatPromptTemplate] Entering Prompt run with input:
[inputs]
[chain/end] [chain:AgentExecutor > chain:RunnableSequence > prompt:ChatPromptTemplate] [2ms] Exiting Prompt run with output:
[outputs]
[llm/start] [chain:AgentExecutor > chain:RunnableSequence > llm:ChatOpenAI] Entering LLM run with input:
{
  "prompts": [
    "System: ä½ æ˜¯ä¸€ä½å¾—åŠ›çš„åŠ©æ‰‹ã€‚\nHuman: è°æ‰§å¯¼äº†2023å¹´çš„ç”µå½±ã€Šå¥¥æœ¬æµ·é»˜ã€‹ï¼Œä»–å¤šå°‘å²äº†ï¼Ÿ\nAI: \nTool: [{\"url\": \"https://baike.baidu.com/item/å¥¥æœ¬æµ·é»˜/58802734\", \"content\": \"ã€Šå¥¥æœ¬æµ·é»˜ã€‹æ˜¯å…‹é‡Œæ–¯æ‰˜å¼—Â·è¯ºå…°è‡ªç¼–è‡ªå¯¼çš„ï¼Œç”±åŸºé‡Œå®‰Â·å¢¨è²ä¸»æ¼”çš„ä¼ è®°ç”µå½±ï¼Œè¯¥ç‰‡äº2023å¹´7æœˆ21æ—¥åœ¨åŒ—ç¾ä¸Šæ˜ ï¼Œ8æœˆ30æ—¥åœ¨ä¸­å›½å†…åœ°ä¸Šæ˜ ï¼Œ2024å¹´3æœˆ29æ—¥åœ¨æ—¥æœ¬ä¸Šæ˜ ã€‚è¯¥ç‰‡æ”¹ç¼–è‡ªKai Birdã€Martin J. Sherwinçš„ã€Šç¾å›½æ™®ç½—ç±³ä¿®æ–¯ï¼šå¥¥æœ¬æµ·é»˜çš„èƒœä¸æ‚²ã€‹ï¼Œå½±ç‰‡ã€Šå¥¥æœ¬æµ·é»˜ã€‹è®²è¿°äº†ç¾å›½\\\"åŸå­å¼¹ä¹‹çˆ¶\\\"ç½—ä¼¯ç‰¹Â· ...\"}]\nAI: 2023å¹´ç”µå½±ã€Šå¥¥æœ¬æµ·é»˜ã€‹çš„å¯¼æ¼”æ˜¯å…‹é‡Œæ–¯æ‰˜å¼—Â·è¯ºå…°ã€‚æ¥ä¸‹æ¥æˆ‘å°†æŸ¥è¯¢ä»–çš„å¹´é¾„ã€‚\nTool: [{\"url\": \"https://baike.baidu.com/item/å…‹é‡Œæ–¯æ‰˜å¼—Â·è¯ºå…°/5306405\", \"content\": \"å…‹é‡Œæ–¯æ‰˜å¼—Â·è¯ºå…°ï¼ˆChristopher Nolanï¼‰ï¼Œ1970å¹´7æœˆ30æ—¥å‡ºç”Ÿäºè‹±å›½ä¼¦æ•¦ï¼Œå¯¼æ¼”ã€ç¼–å‰§ã€åˆ¶ç‰‡äººã€‚1998å¹´4æœˆ24æ—¥å…‹é‡Œæ–¯æ‰˜å¼—Â·è¯ºå…°æ‹æ‘„çš„é¦–éƒ¨æ•…äº‹ç‰‡ã€Šè¿½éšã€‹åœ¨æ—§é‡‘å±±ç”µå½±èŠ‚ä¸Šæ˜ ã€‚2000å¹´ï¼Œå…‹é‡Œæ–¯æ‰˜å¼—Â·è¯ºå…°å‡­å€Ÿç€ä»–çš„ã€Šè®°å¿†ç¢ç‰‡ã€‹ä¸ºä»–è·å¾—ç¬¬74å±Šå¥¥æ–¯å¡çš„æåã€‚2005å¹´ï¼Œæ‰§å¯¼ã€Šè™è ä¾ ã€‹ä¸‰éƒ¨æ›²ç³»åˆ—é¦–éƒ¨ç”µå½± ...\"}]"
  ]
}
[llm/end] [chain:AgentExecutor > chain:RunnableSequence > llm:ChatOpenAI] [885ms] Exiting LLM run with output:
{
  "generations": [
    [
      {
        "text": "å…‹é‡Œæ–¯æ‰˜å¼—Â·è¯ºå…°ï¼ˆChristopher Nolanï¼‰å‡ºç”Ÿäº1970å¹´7æœˆ30æ—¥ã€‚æ ¹æ®å½“å‰æ—¶é—´ï¼ˆ2023å¹´ï¼‰ï¼Œä»–53å²ã€‚",
        "generation_info": {
          "finish_reason": "stop",
          "model_name": "gpt-4o-2024-05-13",
          "system_fingerprint": "fp_4e2b2da518"
        },
        "type": "ChatGenerationChunk",
        "message": {
          "lc": 1,
          "type": "constructor",
          "id": [
            "langchain",
            "schema",
            "messages",
            "AIMessageChunk"
          ],
          "kwargs": {
            "content": "å…‹é‡Œæ–¯æ‰˜å¼—Â·è¯ºå…°ï¼ˆChristopher Nolanï¼‰å‡ºç”Ÿäº1970å¹´7æœˆ30æ—¥ã€‚æ ¹æ®å½“å‰æ—¶é—´ï¼ˆ2023å¹´ï¼‰ï¼Œä»–53å²ã€‚",
            "response_metadata": {
              "finish_reason": "stop",
              "model_name": "gpt-4o-2024-05-13",
              "system_fingerprint": "fp_4e2b2da518"
            },
            "type": "AIMessageChunk",
            "id": "run-0cc2156a-5a9d-41c2-b8bc-ecb2a291f408",
            "tool_calls": [],
            "invalid_tool_calls": []
          }
        }
      }
    ]
  ],
  "llm_output": null,
  "run": null
}
[chain/start] [chain:AgentExecutor > chain:RunnableSequence > parser:ToolsAgentOutputParser] Entering Parser run with input:
[inputs]
[chain/end] [chain:AgentExecutor > chain:RunnableSequence > parser:ToolsAgentOutputParser] [1ms] Exiting Parser run with output:
[outputs]
[chain/end] [chain:AgentExecutor > chain:RunnableSequence] [914ms] Exiting Chain run with output:
[outputs]
[chain/end] [chain:AgentExecutor] [9.25s] Exiting Chain run with output:
{
  "output": "å…‹é‡Œæ–¯æ‰˜å¼—Â·è¯ºå…°ï¼ˆChristopher Nolanï¼‰å‡ºç”Ÿäº1970å¹´7æœˆ30æ—¥ã€‚æ ¹æ®å½“å‰æ—¶é—´ï¼ˆ2023å¹´ï¼‰ï¼Œä»–53å²ã€‚"
}
```

```json
{'input': 'è°æ‰§å¯¼äº†2023å¹´çš„ç”µå½±ã€Šå¥¥æœ¬æµ·é»˜ã€‹ï¼Œä»–å¤šå°‘å²äº†ï¼Ÿ', 'output': 'å…‹é‡Œæ–¯æ‰˜å¼—Â·è¯ºå…°ï¼ˆChristopher Nolanï¼‰å‡ºç”Ÿäº1970å¹´7æœˆ30æ—¥ã€‚æ ¹æ®å½“å‰æ—¶é—´ï¼ˆ2023å¹´ï¼‰ï¼Œä»–53å²ã€‚'}
```

---



